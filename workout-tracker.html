<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="GymLog" />
  <title>GymLog</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap');

    :root {
      --bg: #0c0c0e;
      --surface: #161618;
      --surface2: #1f1f22;
      --surface3: #2a2a2e;
      --border: #2e2e33;
      --accent: #d4f53c;
      --accent-dim: rgba(212,245,60,0.12);
      --text: #f2f2f5;
      --text-muted: #7a7a85;
      --text-faint: #44444d;
      --red: #ff4f4f;
      --red-dim: rgba(255,79,79,0.12);
      --blue: #4f9fff;
      --r: 14px;
      --r-sm: 8px;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html { font-size: 16px; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', -apple-system, sans-serif;
      min-height: 100dvh;
      max-width: 430px;
      margin: 0 auto;
      overflow-x: hidden;
    }

    /* â”€â”€ VIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .view { display: none; flex-direction: column; min-height: 100dvh; animation: fadeIn .18s ease; }
    .view.active { display: flex; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }

    /* â”€â”€ SAFE AREA TOP PAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .safe-top { height: max(env(safe-area-inset-top), 44px); flex-shrink: 0; }

    /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      padding: 12px 20px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-shrink: 0;
    }

    .logo {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      color: var(--accent);
      letter-spacing: 1px;
      line-height: 1;
    }

    .header-sub {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    /* â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      border: none;
      cursor: pointer;
      font-family: inherit;
      font-weight: 600;
      transition: opacity .12s, transform .08s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      line-height: 1;
    }
    .btn:active { opacity: .75; transform: scale(.97); }

    .btn-accent {
      background: var(--accent);
      color: #0c0c0e;
      border-radius: 50px;
      padding: 14px 24px;
      font-size: 15px;
    }

    .btn-ghost {
      background: var(--surface2);
      color: var(--text);
      border-radius: 50px;
      padding: 10px 18px;
      font-size: 14px;
    }

    .btn-ghost-accent {
      background: var(--accent-dim);
      color: var(--accent);
      border-radius: 50px;
      padding: 10px 18px;
      font-size: 14px;
    }

    .btn-danger {
      background: var(--red-dim);
      color: var(--red);
      border-radius: 50px;
      padding: 10px 18px;
      font-size: 14px;
    }

    .btn-icon {
      background: var(--surface2);
      color: var(--text-muted);
      border-radius: 50px;
      width: 36px;
      height: 36px;
      font-size: 18px;
    }

    .btn-icon.red { background: var(--red-dim); color: var(--red); }

    /* â”€â”€ SCROLLABLE BODY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .scroll-body {
      flex: 1;
      overflow-y: auto;
      padding: 8px 20px;
      padding-bottom: max(env(safe-area-inset-bottom), 24px);
      -webkit-overflow-scrolling: touch;
    }

    /* â”€â”€ SECTION LABEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin: 20px 0 10px;
    }

    /* â”€â”€ HOME: WORKOUT CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .workout-card {
      background: var(--surface);
      border-radius: var(--r);
      padding: 16px;
      margin-bottom: 10px;
      cursor: pointer;
      border: 1px solid var(--border);
      transition: border-color .12s;
    }
    .workout-card:active { border-color: var(--accent); }

    .card-date {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      letter-spacing: .3px;
      margin-bottom: 6px;
    }

    .card-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 22px;
      color: var(--text);
      letter-spacing: .5px;
      margin-bottom: 6px;
    }

    .card-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      background: var(--surface2);
      border-radius: 6px;
      padding: 4px 10px;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
    }

    .chip.accent { background: var(--accent-dim); color: var(--accent); }

    /* â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .empty-state {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 60px 20px;
      text-align: center;
    }

    .empty-icon { font-size: 56px; opacity: .3; }
    .empty-title { font-size: 20px; font-weight: 700; color: var(--text-muted); }
    .empty-sub { font-size: 14px; color: var(--text-faint); }

    /* â”€â”€ FAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .fab {
      position: fixed;
      bottom: max(env(safe-area-inset-bottom), 24px);
      right: 24px;
      left: 24px;
      max-width: 390px;
      margin: 0 auto;
      background: var(--accent);
      color: #0c0c0e;
      border: none;
      border-radius: 50px;
      padding: 18px;
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 8px 30px rgba(212,245,60,0.25);
      transition: opacity .12s, transform .08s;
    }
    .fab:active { opacity: .85; transform: scale(.98); }

    /* â”€â”€ INPUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-row {
      display: grid;
      gap: 8px;
      margin-bottom: 8px;
    }

    .input-row.cols-2 { grid-template-columns: 1fr 1fr; }
    .input-row.cols-3 { grid-template-columns: 2fr 1fr 1fr; }

    label.field {
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      letter-spacing: .4px;
    }

    input, select {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: var(--r-sm);
      color: var(--text);
      font-family: inherit;
      font-size: 16px;
      font-weight: 500;
      padding: 12px 14px;
      width: 100%;
      outline: none;
      transition: border-color .12s;
      -webkit-appearance: none;
    }

    input:focus, select:focus { border-color: var(--accent); }
    input::placeholder { color: var(--text-faint); }

    select option { background: var(--surface2); }

    /* â”€â”€ ENTRY CARDS (inside log view) â”€â”€â”€â”€â”€â”€â”€â”€ */
    .entry-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 14px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .entry-card-body { flex: 1; }
    .entry-card-name { font-size: 15px; font-weight: 600; }
    .entry-card-detail { font-size: 13px; color: var(--text-muted); margin-top: 2px; }

    /* â”€â”€ ADD FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .add-form {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--r);
      padding: 16px;
      margin-bottom: 10px;
    }

    .add-form-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-muted);
      letter-spacing: .6px;
      text-transform: uppercase;
      margin-bottom: 12px;
    }

    .add-btn-row {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    /* â”€â”€ DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .divider {
      height: 1px;
      background: var(--border);
      margin: 16px 0;
    }

    /* â”€â”€ DETAIL VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .detail-date {
      font-size: 13px;
      color: var(--text-muted);
      font-weight: 500;
      margin-bottom: 4px;
    }

    .detail-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 40px;
      color: var(--text);
      letter-spacing: .5px;
      line-height: 1;
      margin-bottom: 20px;
    }

    .detail-row {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
      gap: 12px;
    }

    .detail-row:last-child { border-bottom: none; }

    .detail-row-icon {
      width: 34px;
      height: 34px;
      border-radius: 8px;
      background: var(--surface2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    .detail-row-name { font-size: 15px; font-weight: 600; flex: 1; }
    .detail-row-meta { font-size: 13px; color: var(--text-muted); text-align: right; }

    .action-bar {
      display: flex;
      gap: 10px;
      padding: 16px 20px;
      padding-bottom: max(env(safe-area-inset-bottom), 20px);
      flex-shrink: 0;
      border-top: 1px solid var(--border);
    }

    .action-bar .btn { flex: 1; }

    /* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: fixed;
      bottom: max(env(safe-area-inset-bottom), 100px);
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--accent);
      color: #0c0c0e;
      padding: 12px 22px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 700;
      pointer-events: none;
      opacity: 0;
      transition: opacity .2s, transform .2s;
      white-space: nowrap;
      z-index: 999;
    }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* â”€â”€ MODAL OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.7);
      z-index: 100;
      align-items: flex-end;
    }
    #modal-overlay.show { display: flex; }

    .modal-sheet {
      background: var(--surface);
      border-radius: 20px 20px 0 0;
      padding: 24px 20px;
      padding-bottom: max(env(safe-area-inset-bottom), 24px);
      width: 100%;
      border-top: 1px solid var(--border);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .modal-sub {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    .modal-actions { display: flex; flex-direction: column; gap: 10px; }
    .modal-actions .btn { padding: 16px; border-radius: var(--r); font-size: 16px; }

    /* â”€â”€ WORKOUT NAME EDITING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .name-input {
      background: transparent !important;
      border: none !important;
      font-family: 'Bebas Neue', sans-serif !important;
      font-size: 36px !important;
      color: var(--text) !important;
      padding: 0 !important;
      letter-spacing: .5px !important;
      width: 100%;
    }
    .name-input:focus { outline: none; }
    .name-input::placeholder { color: var(--text-faint) !important; }

    /* No items placeholder */
    .no-items {
      color: var(--text-faint);
      font-size: 14px;
      padding: 10px 0 4px;
      font-style: italic;
    }

    .bottom-spacer { height: 90px; flex-shrink: 0; }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="view active" id="view-home">
  <div class="safe-top"></div>
  <div class="header">
    <div>
      <div class="logo">GymLog</div>
      <div class="header-sub" id="home-subtitle">Your sessions</div>
    </div>
  </div>

  <div class="scroll-body" id="home-list">
    <!-- populated by JS -->
  </div>

  <div class="bottom-spacer"></div>

  <button class="fab" onclick="startNewWorkout()">
    <span style="font-size:20px;">ï¼‹</span> New Workout
  </button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: LOG (active workout)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="view" id="view-log">
  <div class="safe-top"></div>
  <div class="header">
    <button class="btn btn-ghost" onclick="cancelLog()">â† Back</button>
    <div style="font-size:13px; color:var(--text-muted);" id="log-timestamp"></div>
  </div>

  <div class="scroll-body">
    <!-- Workout name -->
    <input class="name-input" id="log-name" type="text" placeholder="Workout Nameâ€¦" maxlength="40" />

    <!-- â”€â”€ CARDIO SECTION â”€â”€ -->
    <div class="section-label">Cardio</div>

    <div id="cardio-list"></div>

    <div class="add-form" id="cardio-form">
      <div class="add-form-title">Add Cardio</div>
      <div class="input-row cols-2">
        <label class="field">Type
          <select id="c-type">
            <option>Running</option>
            <option>Walking</option>
            <option>Cycling</option>
            <option>Rowing</option>
            <option>Elliptical</option>
            <option>Stairmaster</option>
            <option>Jump Rope</option>
            <option>Swimming</option>
            <option>HIIT</option>
            <option>Other</option>
          </select>
        </label>
        <label class="field">Duration (min)
          <input id="c-duration" type="number" inputmode="decimal" placeholder="30" min="1" max="999" />
        </label>
      </div>
      <div class="add-btn-row">
        <button class="btn btn-ghost-accent" style="flex:1" onclick="addCardio()">ï¼‹ Add</button>
      </div>
    </div>

    <!-- â”€â”€ EXERCISE SECTION â”€â”€ -->
    <div class="section-label">Exercises</div>

    <div id="exercise-list"></div>

    <div class="add-form">
      <div class="add-form-title">Add Exercise</div>
      <label class="field" style="margin-bottom:8px;">Exercise Name
        <input id="e-name" type="text" placeholder="e.g. Bench Press" autocomplete="off" autocorrect="off" />
      </label>
      <div class="input-row cols-3">
        <label class="field">Weight (lbs)
          <input id="e-weight" type="number" inputmode="decimal" placeholder="135" min="0" />
        </label>
        <label class="field">Sets
          <input id="e-sets" type="number" inputmode="numeric" placeholder="3" min="1" max="99" />
        </label>
        <label class="field">Reps
          <input id="e-reps" type="number" inputmode="numeric" placeholder="10" min="1" max="999" />
        </label>
      </div>
      <div class="add-btn-row">
        <button class="btn btn-ghost-accent" style="flex:1" onclick="addExercise()">ï¼‹ Add</button>
      </div>
    </div>

    <div class="bottom-spacer"></div>
  </div>

  <div class="action-bar">
    <button class="btn btn-ghost btn-danger" onclick="cancelLog()">Discard</button>
    <button class="btn btn-accent" style="flex:2" onclick="saveWorkout()">Save Workout âœ“</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: DETAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="view" id="view-detail">
  <div class="safe-top"></div>
  <div class="header">
    <button class="btn btn-ghost" onclick="showView('home')">â† Back</button>
  </div>

  <div class="scroll-body">
    <div class="detail-date" id="detail-date"></div>
    <div class="detail-title" id="detail-name"></div>

    <div id="detail-cardio-section" style="display:none;">
      <div class="section-label">Cardio</div>
      <div id="detail-cardio-list"></div>
      <div class="divider"></div>
    </div>

    <div id="detail-exercise-section" style="display:none;">
      <div class="section-label">Exercises</div>
      <div id="detail-exercise-list"></div>
    </div>
  </div>

  <div class="action-bar">
    <button class="btn btn-danger" onclick="confirmDelete()">ğŸ—‘</button>
    <button class="btn btn-ghost" style="flex:1" onclick="copyWorkout()">ğŸ“‹ Copy</button>
    <button class="btn btn-accent" style="flex:2" onclick="editWorkout()">âœï¸ Edit</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DELETE CONFIRM MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="modal-overlay" onclick="closeModal()">
  <div class="modal-sheet" onclick="event.stopPropagation()">
    <div class="modal-title">Delete workout?</div>
    <div class="modal-sub">This can't be undone.</div>
    <div class="modal-actions">
      <button class="btn btn-danger" onclick="deleteWorkout()">Yes, Delete</button>
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const STORAGE_KEY = 'gymlog_workouts_v1';

function loadWorkouts() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  } catch { return []; }
}

function saveWorkouts(workouts) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(workouts));
}

function uid() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
}

// Current state
let workouts = loadWorkouts();
let currentWorkout = null;  // workout being logged
let viewingId = null;       // id of workout being viewed
let isEditing = false;      // whether we're editing an existing workout

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function showView(name) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');
  if (name === 'home') renderHome();
  if (name === 'detail') renderDetail();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FORMAT HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function formatDate(iso) {
  const d = new Date(iso);
  return d.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' });
}

function formatTime(iso) {
  const d = new Date(iso);
  return d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
}

function formatDateTime(iso) {
  return formatDate(iso) + ' Â· ' + formatTime(iso);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderHome() {
  workouts = loadWorkouts();
  const el = document.getElementById('home-list');
  const sub = document.getElementById('home-subtitle');

  sub.textContent = workouts.length
    ? `${workouts.length} session${workouts.length > 1 ? 's' : ''} logged`
    : 'Your sessions';

  if (!workouts.length) {
    el.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon">ğŸ‹ï¸</div>
        <div class="empty-title">No workouts yet</div>
        <div class="empty-sub">Tap New Workout to log your first session</div>
      </div>`;
    return;
  }

  // Sort newest first
  const sorted = [...workouts].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

  el.innerHTML = sorted.map(w => {
    const cardioChips = (w.cardio || []).map(c =>
      `<span class="chip accent">ğŸƒ ${c.type} ${c.minutes}m</span>`).join('');
    const exChips = uniqueExercises(w.exercises).slice(0, 3).map(n =>
      `<span class="chip">ğŸ‹ï¸ ${n}</span>`).join('');
    const more = uniqueExercises(w.exercises).length > 3
      ? `<span class="chip">+${uniqueExercises(w.exercises).length - 3} more</span>` : '';

    return `
      <div class="workout-card" onclick="openWorkout('${w.id}')">
        <div class="card-date">${formatDateTime(w.timestamp)}</div>
        <div class="card-title">${escHtml(w.name || 'Workout')}</div>
        <div class="card-chips">${cardioChips}${exChips}${more}</div>
      </div>`;
  }).join('');
}

function uniqueExercises(exercises) {
  const seen = new Set();
  return (exercises || []).filter(e => {
    if (seen.has(e.name)) return false;
    seen.add(e.name);
    return true;
  }).map(e => e.name);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// START / CANCEL LOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function startNewWorkout() {
  isEditing = false;
  currentWorkout = {
    id: uid(),
    timestamp: new Date().toISOString(),
    name: '',
    cardio: [],
    exercises: []
  };
  renderLogView();
  showView('log');
}

function cancelLog() {
  if (isEditing) {
    // Just go back to detail view
    showView('detail');
    return;
  }
  showView('home');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOG VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderLogView() {
  document.getElementById('log-name').value = currentWorkout.name || '';
  document.getElementById('log-timestamp').textContent = formatDateTime(currentWorkout.timestamp);
  renderCardioList();
  renderExerciseList();
}

function renderCardioList() {
  const el = document.getElementById('cardio-list');
  if (!currentWorkout.cardio.length) {
    el.innerHTML = '<div class="no-items">No cardio added yet</div>';
    return;
  }
  el.innerHTML = currentWorkout.cardio.map((c, i) => `
    <div class="entry-card">
      <div class="detail-row-icon">ğŸƒ</div>
      <div class="entry-card-body">
        <div class="entry-card-name">${escHtml(c.type)}</div>
        <div class="entry-card-detail">${c.minutes} minutes</div>
      </div>
      <button class="btn btn-icon red" onclick="removeCardio(${i})">âœ•</button>
    </div>`).join('');
}

function renderExerciseList() {
  const el = document.getElementById('exercise-list');
  if (!currentWorkout.exercises.length) {
    el.innerHTML = '<div class="no-items">No exercises added yet</div>';
    return;
  }
  el.innerHTML = currentWorkout.exercises.map((e, i) => `
    <div class="entry-card">
      <div class="detail-row-icon">ğŸ‹ï¸</div>
      <div class="entry-card-body">
        <div class="entry-card-name">${escHtml(e.name)}</div>
        <div class="entry-card-detail">${e.sets} set${e.sets != 1 ? 's' : ''} Ã— ${e.reps} reps${e.weight ? ' @ ' + e.weight + ' lbs' : ''}</div>
      </div>
      <button class="btn btn-icon red" onclick="removeExercise(${i})">âœ•</button>
    </div>`).join('');
}

function addCardio() {
  const type = document.getElementById('c-type').value;
  const minutes = parseInt(document.getElementById('c-duration').value, 10);
  if (!minutes || minutes < 1) { showToast('Enter a duration'); return; }
  currentWorkout.cardio.push({ type, minutes });
  document.getElementById('c-duration').value = '';
  renderCardioList();
}

function addExercise() {
  const name = document.getElementById('e-name').value.trim();
  const weight = document.getElementById('e-weight').value.trim();
  const sets = parseInt(document.getElementById('e-sets').value, 10);
  const reps = parseInt(document.getElementById('e-reps').value, 10);

  if (!name) { showToast('Enter an exercise name'); return; }
  if (!sets || sets < 1) { showToast('Enter number of sets'); return; }
  if (!reps || reps < 1) { showToast('Enter number of reps'); return; }

  currentWorkout.exercises.push({
    name,
    weight: weight || null,
    sets,
    reps
  });

  // Keep name for quick multi-set entry, clear numbers
  document.getElementById('e-weight').value = '';
  document.getElementById('e-sets').value = '';
  document.getElementById('e-reps').value = '';
  renderExerciseList();
}

function removeCardio(i) {
  currentWorkout.cardio.splice(i, 1);
  renderCardioList();
}

function removeExercise(i) {
  currentWorkout.exercises.splice(i, 1);
  renderExerciseList();
}

function saveWorkout() {
  const name = document.getElementById('log-name').value.trim();
  currentWorkout.name = name || autoName();

  if (!currentWorkout.cardio.length && !currentWorkout.exercises.length) {
    showToast('Add at least one exercise or cardio');
    return;
  }

  workouts = loadWorkouts();

  if (isEditing) {
    const idx = workouts.findIndex(w => w.id === currentWorkout.id);
    if (idx >= 0) workouts[idx] = currentWorkout;
    else workouts.push(currentWorkout);
  } else {
    workouts.push(currentWorkout);
  }

  saveWorkouts(workouts);
  viewingId = currentWorkout.id;
  showToast('Workout saved âœ“');
  isEditing = false;
  showView('detail');
}

function autoName() {
  const hour = new Date(currentWorkout.timestamp).getHours();
  if (hour < 12) return 'Morning Workout';
  if (hour < 17) return 'Afternoon Workout';
  return 'Evening Workout';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DETAIL VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function openWorkout(id) {
  viewingId = id;
  showView('detail');
}

function renderDetail() {
  workouts = loadWorkouts();
  const w = workouts.find(x => x.id === viewingId);
  if (!w) { showView('home'); return; }

  document.getElementById('detail-date').textContent = formatDateTime(w.timestamp);
  document.getElementById('detail-name').textContent = w.name || 'Workout';

  // Cardio
  const cardioSec = document.getElementById('detail-cardio-section');
  const cardioList = document.getElementById('detail-cardio-list');
  if (w.cardio && w.cardio.length) {
    cardioSec.style.display = '';
    cardioList.innerHTML = w.cardio.map(c => `
      <div class="detail-row">
        <div class="detail-row-icon">ğŸƒ</div>
        <div class="detail-row-name">${escHtml(c.type)}</div>
        <div class="detail-row-meta">${c.minutes} min</div>
      </div>`).join('');
  } else {
    cardioSec.style.display = 'none';
  }

  // Exercises
  const exSec = document.getElementById('detail-exercise-section');
  const exList = document.getElementById('detail-exercise-list');
  if (w.exercises && w.exercises.length) {
    exSec.style.display = '';
    exList.innerHTML = w.exercises.map(e => `
      <div class="detail-row">
        <div class="detail-row-icon">ğŸ‹ï¸</div>
        <div class="detail-row-name">${escHtml(e.name)}</div>
        <div class="detail-row-meta">
          ${e.sets}Ã—${e.reps}${e.weight ? '<br>' + e.weight + ' lbs' : ''}
        </div>
      </div>`).join('');
  } else {
    exSec.style.display = 'none';
  }
}

function editWorkout() {
  workouts = loadWorkouts();
  const w = workouts.find(x => x.id === viewingId);
  if (!w) return;
  isEditing = true;
  currentWorkout = JSON.parse(JSON.stringify(w)); // deep copy
  renderLogView();
  showView('log');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DELETE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function confirmDelete() {
  document.getElementById('modal-overlay').classList.add('show');
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('show');
}

function deleteWorkout() {
  workouts = loadWorkouts();
  workouts = workouts.filter(w => w.id !== viewingId);
  saveWorkouts(workouts);
  closeModal();
  showToast('Workout deleted');
  showView('home');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COPY AS PLAIN TEXT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function copyWorkout() {
  workouts = loadWorkouts();
  const w = workouts.find(x => x.id === viewingId);
  if (!w) return;

  let text = '';
  text += `${w.name || 'Workout'}\n`;
  text += `${formatDateTime(w.timestamp)}\n`;
  text += `${'â”€'.repeat(30)}\n\n`;

  if (w.cardio && w.cardio.length) {
    text += `CARDIO\n`;
    w.cardio.forEach(c => {
      text += `  â€¢ ${c.type} â€” ${c.minutes} min\n`;
    });
    text += '\n';
  }

  if (w.exercises && w.exercises.length) {
    text += `EXERCISES\n`;
    w.exercises.forEach(e => {
      const wt = e.weight ? ` @ ${e.weight} lbs` : '';
      text += `  â€¢ ${e.name} â€” ${e.sets} set${e.sets != 1 ? 's' : ''} Ã— ${e.reps} reps${wt}\n`;
    });
    text += '\n';
  }

  text += `â”€`.repeat(30);

  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text)
      .then(() => showToast('Copied to clipboard âœ“'))
      .catch(() => fallbackCopy(text));
  } else {
    fallbackCopy(text);
  }
}

function fallbackCopy(text) {
  const ta = document.createElement('textarea');
  ta.value = text;
  ta.style.cssText = 'position:fixed;opacity:0;top:0;left:0;';
  document.body.appendChild(ta);
  ta.focus();
  ta.select();
  try {
    document.execCommand('copy');
    showToast('Copied to clipboard âœ“');
  } catch {
    showToast('Copy failed â€” select text manually');
  }
  document.body.removeChild(ta);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESCAPE HTML
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function escHtml(s) {
  return String(s)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PREVENT ZOOM ON DOUBLE TAP (iOS)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let lastTap = 0;
document.addEventListener('touchend', e => {
  const now = Date.now();
  if (now - lastTap < 300) e.preventDefault();
  lastTap = now;
}, { passive: false });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

renderHome();
</script>
</body>
</html>
