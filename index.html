<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="GymLog" />
  <title>GymLog</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#0c0c0e; --surface:#161618; --surface2:#1f1f22; --border:#2e2e33;
      --accent:#d4f53c; --accent-dim:rgba(212,245,60,0.12);
      --text:#f2f2f5; --text-muted:#7a7a85; --text-faint:#38383f;
      --red:#ff4f4f; --red-dim:rgba(255,79,79,0.12);
      --blue:#4f9fff; --blue-dim:rgba(79,159,255,0.12);
      --r:14px; --r-sm:8px; --nav-h:64px;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
    html{font-size:16px;background:#0c0c0e}
    body{background:var(--bg);color:var(--text);font-family:'DM Sans',-apple-system,sans-serif;min-height:100vh;max-width:430px;margin:0 auto;overflow-x:hidden}

```
.view{display:none;flex-direction:column;min-height:100vh;animation:fadeIn .18s ease}
.view.active{display:flex}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:none}}

.safe-top{height:max(env(safe-area-inset-top,0px),44px);flex-shrink:0}

/* NAV */
.bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;height:calc(var(--nav-h) + env(safe-area-inset-bottom,0px));background:#161618;border-top:1px solid var(--border);display:flex;align-items:flex-start;padding-top:10px;z-index:50}
.nav-btn{flex:1;background:none;border:none;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;padding:0 8px}
.nav-icon{font-size:22px;line-height:1}
.nav-label{font-size:10px;font-weight:600;letter-spacing:.4px;color:var(--text-muted);text-transform:uppercase}
.nav-btn.active .nav-label{color:var(--accent)}
.bottom-spacer{height:calc(var(--nav-h) + env(safe-area-inset-bottom,0px) + 16px);flex-shrink:0}

.header{padding:10px 20px 6px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.logo{font-family:'Bebas Neue',sans-serif;font-size:34px;color:var(--accent);letter-spacing:1px;line-height:1;white-space:nowrap}
.header-sub{font-size:12px;color:var(--text-muted);margin-top:1px}

/* BUTTONS */
.btn{border:none;cursor:pointer;font-family:inherit;font-weight:600;display:flex;align-items:center;justify-content:center;gap:6px;line-height:1}
.btn-accent{background:var(--accent);color:#0c0c0e;border-radius:50px;padding:14px 24px;font-size:15px}
.btn-ghost{background:var(--surface2);color:var(--text);border-radius:50px;padding:10px 18px;font-size:14px}
.btn-ga{background:var(--accent-dim);color:var(--accent);border-radius:50px;padding:10px 18px;font-size:14px}
.btn-danger{background:var(--red-dim);color:var(--red);border-radius:50px;padding:10px 18px;font-size:14px}
.btn-icon{background:var(--surface2);color:var(--text-muted);border-radius:50px;width:36px;height:36px;font-size:16px;flex-shrink:0}
.btn-icon.red{background:var(--red-dim);color:var(--red)}

.scroll-body{flex:1;overflow-y:auto;padding:6px 20px;-webkit-overflow-scrolling:touch}
.section-label{font-size:11px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--text-muted);margin:18px 0 8px;display:flex;align-items:center;justify-content:space-between}
.section-count{font-weight:500;letter-spacing:0;text-transform:none;color:var(--text-faint);font-size:11px}

/* HOME CARDS */
.workout-card{background:var(--surface);border-radius:var(--r);padding:16px;margin-bottom:10px;cursor:pointer;border:1px solid var(--border)}
.card-date{font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:4px}
.card-title{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:.4px;margin-bottom:6px}
.card-chips{display:flex;flex-wrap:wrap;gap:5px}
.chip{background:var(--surface2);border-radius:6px;padding:3px 9px;font-size:12px;font-weight:500;color:var(--text-muted)}
.chip.accent{background:var(--accent-dim);color:var(--accent)}

.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:60px 20px;text-align:center}
.empty-icon{font-size:52px;opacity:.25}
.empty-title{font-size:18px;font-weight:700;color:var(--text-muted)}
.empty-sub{font-size:13px;color:var(--text-faint);line-height:1.6}

.fab{position:fixed;bottom:calc(var(--nav-h) + env(safe-area-inset-bottom,0px) + 14px);left:20px;right:20px;max-width:390px;margin:0 auto;background:var(--accent);color:#0c0c0e;border:none;border-radius:50px;padding:16px 22px;font-family:'DM Sans',sans-serif;font-weight:700;font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;box-shadow:0 6px 24px rgba(212,245,60,0.28);z-index:49}

/* INPUTS */
.input-row{display:grid;gap:8px;margin-bottom:8px}
.input-row.cols-2{grid-template-columns:1fr 1fr}
.input-row.cols-3{grid-template-columns:2fr 1fr 1fr}
label.field{display:flex;flex-direction:column;gap:4px;font-size:12px;font-weight:600;color:var(--text-muted);letter-spacing:.4px}
input,select{background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-sm);color:var(--text);font-family:inherit;font-size:16px;font-weight:500;padding:11px 13px;width:100%;outline:none;-webkit-appearance:none;appearance:none}
input:focus,select:focus{border-color:var(--accent)}
input::placeholder{color:var(--text-faint)}
input[type="date"],input[type="time"]{color:var(--text)}

.name-input{background:transparent!important;border:none!important;font-family:'Bebas Neue',sans-serif!important;font-size:34px!important;color:var(--text)!important;padding:0!important;letter-spacing:.5px!important;width:100%}
.name-input:focus{outline:none}
.name-input::placeholder{color:var(--text-faint)!important}

.date-row{display:flex;align-items:center;gap:8px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--r-sm);padding:10px 13px;margin-bottom:16px;cursor:pointer}
.date-row-text{flex:1;font-size:13px;color:var(--text-muted)}
.date-row-icon{font-size:14px;color:var(--text-faint)}
.date-editor{display:none;background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:14px;margin-bottom:16px}
.date-editor.open{display:block}

/* ‚îÄ‚îÄ STAGING CARDS ‚îÄ‚îÄ */
.stage-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:13px 14px;margin-bottom:8px;display:flex;align-items:center;gap:11px;cursor:pointer;transition:border-color .12s,opacity .15s}
.stage-card:active{border-color:var(--accent)}
.stage-card .card-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
.stage-card .card-icon.ex{background:var(--accent-dim)}
.stage-card .card-icon.ca{background:var(--blue-dim)}
.stage-card .card-body{flex:1;min-width:0}
.stage-card .card-name{font-size:15px;font-weight:600}
.stage-card .card-meta{font-size:12px;color:var(--text-muted);margin-top:2px}
.stage-card .card-action{font-size:18px;color:var(--text-faint);flex-shrink:0;padding:0 2px}

.stage-card.in-zone{border-color:rgba(212,245,60,0.25)}
.stage-card.in-zone .card-action{color:var(--red)}

/* ‚îÄ‚îÄ CHECKLIST (active workout) ‚îÄ‚îÄ */
.entry-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:12px;margin-bottom:8px;display:flex;align-items:center;gap:10px;transition:opacity .2s}
.entry-card.checked{opacity:0.5}
.entry-card.checked .entry-name{text-decoration:line-through;text-decoration-color:var(--text-faint)}
.entry-body{flex:1;min-width:0;cursor:pointer}
.entry-name{font-size:15px;font-weight:600}
.entry-detail{font-size:13px;color:var(--text-muted);margin-top:2px}
.check-circle{width:28px;height:28px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;transition:all .15s;font-size:14px;color:transparent}
.check-circle.done{border-color:var(--accent);background:var(--accent);color:#0c0c0e}

.progress-bar-wrap{margin-bottom:16px}
.progress-label{font-size:12px;font-weight:600;color:var(--text-muted);margin-bottom:6px;display:flex;justify-content:space-between}
.progress-track{height:6px;background:var(--surface2);border-radius:3px;overflow:hidden}
.progress-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .3s ease}

/* ‚îÄ‚îÄ ADD FORM (bottom sheet) ‚îÄ‚îÄ */
.add-form{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:15px;margin-bottom:10px}
.add-form-title{font-size:12px;font-weight:700;color:var(--text-muted);letter-spacing:.6px;text-transform:uppercase;margin-bottom:11px}
.add-btn-row{display:flex;gap:8px;margin-top:11px}

/* Type toggle for add form */
.type-toggle{display:flex;gap:6px;margin-bottom:14px}
.type-btn{flex:1;padding:10px 6px;border-radius:50px;font-family:inherit;font-size:13px;font-weight:600;border:none;cursor:pointer;background:var(--surface2);color:var(--text-muted);transition:all .12s}
.type-btn.active{background:var(--accent-dim);color:var(--accent)}

/* ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ */
.detail-date{font-size:13px;color:var(--text-muted);font-weight:500;margin-bottom:3px}
.detail-title{font-family:'Bebas Neue',sans-serif;font-size:38px;letter-spacing:.5px;line-height:1;margin-bottom:18px}
.detail-row{display:flex;align-items:center;padding:11px 0;border-bottom:1px solid var(--border);gap:12px}
.detail-row:last-child{border-bottom:none}
.detail-row-icon{width:32px;height:32px;border-radius:8px;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
.detail-row-name{font-size:15px;font-weight:600;flex:1}
.detail-row-meta{font-size:13px;color:var(--text-muted);text-align:right;line-height:1.5}

.action-bar{display:flex;gap:10px;padding:14px 20px;padding-bottom:max(env(safe-area-inset-bottom,0px),16px);flex-shrink:0;border-top:1px solid var(--border)}
.action-bar .btn{flex:1}

.divider{height:1px;background:var(--border);margin:14px 0}
.no-items{color:var(--text-faint);font-size:14px;padding:6px 0 2px;font-style:italic}

/* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
.ex-pick-row{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:14px 16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;margin-bottom:8px}
.ex-pick-name{font-size:16px;font-weight:600}
.ex-pick-meta{font-size:12px;color:var(--text-muted);margin-top:2px}
.ex-pick-arrow{font-size:20px;color:var(--text-faint)}

/* ‚îÄ‚îÄ GRAPH ‚îÄ‚îÄ */
.graph-title{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:.4px;margin-bottom:3px}
.graph-sub{font-size:13px;color:var(--text-muted);margin-bottom:14px}
.metric-toggle{display:flex;gap:6px;margin-bottom:14px}
.metric-btn{flex:1;padding:9px 6px;border-radius:50px;font-family:inherit;font-size:12px;font-weight:600;border:none;cursor:pointer;background:var(--surface2);color:var(--text-muted)}
.metric-btn.active{background:var(--accent-dim);color:var(--accent)}
.canvas-wrap{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;margin-bottom:14px;overflow:hidden}
canvas{display:block;width:100%}
.graph-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:14px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r-sm);padding:12px;text-align:center}
.stat-val{font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--accent);line-height:1}
.stat-label{font-size:11px;color:var(--text-muted);margin-top:3px}
.history-entry{display:flex;align-items:center;padding:11px 0;border-bottom:1px solid var(--border);gap:10px}
.history-entry:last-child{border-bottom:none}
.history-dot{width:8px;height:8px;background:var(--accent);border-radius:50%;flex-shrink:0}
.history-date{font-size:13px;color:var(--text-muted);flex:1}
.history-val{font-size:15px;font-weight:600}

/* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
.settings-row{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;cursor:pointer}
.settings-row-left{display:flex;align-items:center;gap:13px}
.settings-icon{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.si-green{background:rgba(74,222,128,0.12)}
.si-blue{background:rgba(79,159,255,0.12)}
.si-red{background:var(--red-dim)}
.settings-row-text .s-title{font-size:15px;font-weight:600}
.settings-row-text .s-sub{font-size:12px;color:var(--text-muted);margin-top:2px}
.settings-arrow{font-size:18px;color:var(--text-faint)}
.version-tag{text-align:center;font-size:12px;color:var(--text-faint);padding:20px 0 8px}

/* BACKUP BANNER */
.backup-banner{display:none;margin:0 20px 10px;background:var(--accent-dim);border:1px solid rgba(212,245,60,0.3);border-radius:var(--r);padding:14px 16px;gap:12px;flex-shrink:0}
.backup-banner.show{display:flex;align-items:center}
.banner-icon{font-size:24px;flex-shrink:0}
.banner-body{flex:1}
.banner-title{font-size:14px;font-weight:700;color:var(--accent);margin-bottom:2px}
.banner-sub{font-size:12px;color:var(--text-muted);line-height:1.4}
.banner-actions{display:flex;flex-direction:column;gap:6px;flex-shrink:0}
.banner-btn{background:var(--accent);color:#0c0c0e;border:none;border-radius:50px;padding:8px 14px;font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap}
.banner-dismiss{background:none;border:none;font-size:12px;color:var(--text-faint);cursor:pointer;font-family:inherit;text-align:center}

/* OVERFLOW */
.overflow-wrap{position:relative}
.overflow-menu{display:none;position:absolute;bottom:calc(100% + 10px);right:0;background:var(--surface2);border:1px solid var(--border);border-radius:var(--r);overflow:hidden;min-width:190px;z-index:60}
.overflow-menu.open{display:block}
.overflow-item{display:flex;align-items:center;gap:10px;padding:14px 16px;font-family:inherit;font-size:15px;font-weight:500;background:none;border:none;cursor:pointer;width:100%;color:var(--text);text-align:left;border-bottom:1px solid var(--border)}
.overflow-item:last-child{border-bottom:none}
.overflow-item.red{color:var(--red)}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.72);z-index:100}
.modal-overlay.show{display:block}
.modal-sheet{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;background:var(--surface);border-radius:20px 20px 0 0;padding:22px 20px;padding-bottom:max(env(safe-area-inset-bottom,0px),24px);border-top:1px solid var(--border)}
.modal-title{font-size:18px;font-weight:700;margin-bottom:5px}
.modal-sub{font-size:14px;color:var(--text-muted);margin-bottom:18px}
.modal-actions{display:flex;flex-direction:column;gap:10px}
.modal-actions .btn{padding:16px;border-radius:var(--r);font-size:16px}

/* EDIT SHEET */
.edit-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.72);z-index:150;align-items:flex-end;justify-content:center}
.edit-overlay.show{display:flex}
.edit-sheet{width:100%;max-width:430px;background:var(--surface);border-radius:20px 20px 0 0;padding:22px 20px;padding-bottom:max(env(safe-area-inset-bottom,0px),24px);border-top:1px solid var(--border)}
.edit-sheet-title{font-size:16px;font-weight:700;margin-bottom:14px}

#import-input{display:none}
#toast{position:fixed;bottom:calc(var(--nav-h) + env(safe-area-inset-bottom,0px) + 16px);left:50%;transform:translateX(-50%) translateY(14px);background:var(--accent);color:#0c0c0e;padding:11px 20px;border-radius:50px;font-size:14px;font-weight:700;pointer-events:none;opacity:0;transition:opacity .2s,transform .2s;white-space:nowrap;z-index:999}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
```

  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê HOME ‚ïê‚ïê‚ïê -->

<div class="view active" id="view-home">
  <div class="safe-top"></div>
  <div class="header"><div><div class="logo">GymLog</div><div class="header-sub" id="home-subtitle">Your sessions</div></div></div>
  <div id="backup-banner" class="backup-banner">
    <div class="banner-icon">üîî</div>
    <div class="banner-body"><div class="banner-title">Weekly backup due</div><div class="banner-sub" id="banner-sub">Save your data to a file.</div></div>
    <div class="banner-actions"><button class="banner-btn" onclick="exportBackupFromBanner()">Back up now</button><button class="banner-dismiss" onclick="dismissBanner()">Later</button></div>
  </div>
  <div class="scroll-body" id="home-list"></div>
  <div class="bottom-spacer"></div>
  <button class="fab" onclick="openStaging()"><span style="font-size:18px">Ôºã</span> New Workout</button>
</div>

<!-- ‚ïê‚ïê‚ïê STAGING (bench / in) ‚ïê‚ïê‚ïê -->

<div class="view" id="view-staging">
  <div class="safe-top"></div>
  <div class="header">
    <button class="btn btn-ghost" onclick="closeStaging()">‚Üê Back</button>
    <button class="btn btn-ga" onclick="openAddForm()">Ôºã New</button>
  </div>
  <div class="scroll-body" id="staging-scroll">
    <div style="font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:.4px;margin-bottom:2px">Plan Workout</div>
    <div style="font-size:13px;color:var(--text-muted);margin-bottom:14px">Tap cards to move them in or out</div>

```
<div class="section-label">In <span class="section-count" id="in-count"></span></div>
<div id="in-list"></div>

<div class="section-label">Bench <span class="section-count" id="bench-count"></span></div>
<div id="bench-list"></div>

<div class="bottom-spacer"></div>
```

  </div>
  <div class="action-bar">
    <button class="btn btn-accent" style="flex:1" id="start-workout-btn" onclick="startWorkoutFromStaging()">Start Workout ‚Üí</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê LOG (active workout checklist) ‚ïê‚ïê‚ïê -->

<div class="view" id="view-log">
  <div class="safe-top"></div>
  <div class="header"><button class="btn btn-ghost" onclick="cancelLog()">‚Üê Back</button></div>
  <div class="scroll-body">
    <input class="name-input" id="log-name" type="text" placeholder="Workout Name‚Ä¶" maxlength="40" />
    <div class="date-row" onclick="toggleDateEditor()">
      <div class="date-row-text" id="date-row-display">Loading‚Ä¶</div>
      <div class="date-row-icon">‚úé Change date</div>
    </div>
    <div class="date-editor" id="date-editor">
      <div class="input-row cols-2" style="margin-bottom:10px;">
        <label class="field">Date<input type="date" id="dp-date" onchange="applyDateEdit()" /></label>
        <label class="field">Time<input type="time" id="dp-time" onchange="applyDateEdit()" /></label>
      </div>
      <div style="font-size:12px;color:var(--text-muted);">Tap above to close.</div>
    </div>
    <div class="progress-bar-wrap" id="checklist-progress" style="display:none">
      <div class="progress-label"><span id="progress-text">0 / 0</span><span id="progress-pct" style="color:var(--accent)">0%</span></div>
      <div class="progress-track"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
    </div>
    <div id="checklist-items"></div>
    <div class="bottom-spacer"></div>
  </div>
  <div class="action-bar">
    <button class="btn btn-danger" onclick="cancelLog()">Discard</button>
    <button class="btn btn-accent" style="flex:2" onclick="saveWorkout()">Save Workout ‚úì</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê DETAIL ‚ïê‚ïê‚ïê -->

<div class="view" id="view-detail">
  <div class="safe-top"></div>
  <div class="scroll-body">
    <div class="detail-date" id="detail-date"></div>
    <div class="detail-title" id="detail-name"></div>
    <div id="detail-cardio-section" style="display:none"><div class="section-label">Cardio</div><div id="detail-cardio-list"></div><div class="divider"></div></div>
    <div id="detail-exercise-section" style="display:none"><div class="section-label">Exercises</div><div id="detail-exercise-list"></div></div>
    <div class="bottom-spacer"></div>
  </div>
  <div class="action-bar">
    <button class="btn btn-ghost" style="flex:1" onclick="showTab('home')">‚Üê Back</button>
    <button class="btn btn-accent" style="flex:2" onclick="editWorkout()">‚úèÔ∏è Edit</button>
    <div class="overflow-wrap">
      <button class="btn btn-ghost" onclick="toggleOverflow()" style="width:46px;padding:0;">‚ãØ</button>
      <div class="overflow-menu" id="overflow-menu">
        <button class="overflow-item" onclick="repeatWorkout();closeOverflow()">üîÅ Repeat workout</button>
        <button class="overflow-item" onclick="copyWorkout();closeOverflow()">üìã Copy text</button>
        <button class="overflow-item red" onclick="closeOverflow();confirmDelete()">üóë Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PROGRESS ‚ïê‚ïê‚ïê -->

<div class="view" id="view-progress">
  <div class="safe-top"></div>
  <div class="header"><div><div class="logo">Progress</div><div class="header-sub" id="progress-sub">Tap an exercise to see trends</div></div></div>
  <div class="scroll-body" id="progress-list"></div>
  <div class="bottom-spacer"></div>
</div>

<!-- ‚ïê‚ïê‚ïê GRAPH ‚ïê‚ïê‚ïê -->

<div class="view" id="view-graph">
  <div class="safe-top"></div>
  <div class="header"><button class="btn btn-ghost" onclick="showTab('progress')">‚Üê Exercises</button></div>
  <div class="scroll-body">
    <div class="graph-title" id="graph-title"></div>
    <div class="graph-sub" id="graph-sub"></div>
    <div class="metric-toggle">
      <button class="metric-btn active" id="metric-weight" onclick="setMetric('weight')">Max Weight</button>
      <button class="metric-btn" id="metric-volume" onclick="setMetric('volume')">Volume</button>
      <button class="metric-btn" id="metric-reps" onclick="setMetric('reps')">Max Reps</button>
    </div>
    <div class="canvas-wrap"><canvas id="progress-chart" height="200"></canvas></div>
    <div class="graph-stats" id="graph-stats"></div>
    <div class="section-label">Session History</div>
    <div id="graph-history"></div>
    <div class="bottom-spacer"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê -->

<div class="view" id="view-settings">
  <div class="safe-top"></div>
  <div class="header"><div><div class="logo">Settings</div><div class="header-sub">Data &amp; backup</div></div></div>
  <div class="scroll-body">
    <div class="section-label">Backup</div>
    <div class="settings-row" onclick="exportBackup()">
      <div class="settings-row-left"><div class="settings-icon si-green">‚¨áÔ∏è</div><div class="settings-row-text"><div class="s-title">Export Backup</div><div class="s-sub">Save all workouts as a .json file</div></div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <div class="settings-row" onclick="document.getElementById('import-input').click()">
      <div class="settings-row-left"><div class="settings-icon si-blue">‚¨ÜÔ∏è</div><div class="settings-row-text"><div class="s-title">Import Backup</div><div class="s-sub">Restore from a .json backup file</div></div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <input type="file" id="import-input" accept=".json" onchange="importBackup(event)" />
    <div class="section-label">Danger Zone</div>
    <div class="settings-row" onclick="confirmClearAll()">
      <div class="settings-row-left"><div class="settings-icon si-red">üóëÔ∏è</div><div class="settings-row-text"><div class="s-title" style="color:var(--red)">Clear All Data</div><div class="s-sub">Permanently delete all workouts</div></div></div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <div class="divider"></div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;font-size:13px;color:var(--text-muted);line-height:1.7">
      <strong style="color:var(--text)">üí° About your data</strong><br><br>
      Workouts are stored locally on this device. <strong style="color:var(--accent)">Export a backup regularly</strong> and save it to iCloud Drive or email it to yourself.
    </div>
    <div class="version-tag">GymLog v3.0 ¬∑ Made for iPhone</div>
    <div class="bottom-spacer"></div>
  </div>
</div>

<!-- NAV -->

<nav class="bottom-nav" id="bottom-nav">
  <button class="nav-btn active" id="nav-home" onclick="showTab('home')"><span class="nav-icon">üè†</span><span class="nav-label">Log</span></button>
  <button class="nav-btn" id="nav-progress" onclick="showTab('progress')"><span class="nav-icon">üìà</span><span class="nav-label">Progress</span></button>
  <button class="nav-btn" id="nav-settings" onclick="showTab('settings')"><span class="nav-icon">‚öôÔ∏è</span><span class="nav-label">Settings</span></button>
</nav>

<!-- MODAL -->

<div id="modal-overlay" class="modal-overlay" onclick="closeModal()">
  <div class="modal-sheet" onclick="event.stopPropagation()">
    <div class="modal-title" id="modal-title"></div>
    <div class="modal-sub" id="modal-sub"></div>
    <div class="modal-actions" id="modal-actions"></div>
  </div>
</div>

<!-- ADD FORM (bottom sheet) -->

<div class="edit-overlay" id="add-overlay" onclick="closeAddForm()">
  <div class="edit-sheet" onclick="event.stopPropagation()">
    <div class="edit-sheet-title">Add to Bench</div>
    <div class="type-toggle">
      <button class="type-btn active" id="add-type-ex" onclick="setAddType('exercise')">üèãÔ∏è Exercise</button>
      <button class="type-btn" id="add-type-ca" onclick="setAddType('cardio')">üèÉ Cardio</button>
    </div>
    <div id="add-fields-ex">
      <label class="field" style="margin-bottom:8px">Exercise Name<input type="text" id="add-name" placeholder="e.g. Bicep Curl" autocomplete="off" autocorrect="off" /></label>
      <div class="input-row cols-3">
        <label class="field">Weight (lbs)<input type="number" id="add-weight" inputmode="decimal" placeholder="45" min="0" /></label>
        <label class="field">Sets<input type="number" id="add-sets" inputmode="numeric" placeholder="3" min="1" max="99" /></label>
        <label class="field">Reps<input type="number" id="add-reps" inputmode="numeric" placeholder="10" min="1" max="999" /></label>
      </div>
    </div>
    <div id="add-fields-ca" style="display:none">
      <div class="input-row cols-2">
        <label class="field">Type
          <select id="add-ctype"><option>Running</option><option>Walking</option><option>Cycling</option><option>Rowing</option><option>Elliptical</option><option>Stairmaster</option><option>Jump Rope</option><option>Swimming</option><option>HIIT</option><option>Other</option></select>
        </label>
        <label class="field">Duration (min)<input type="number" id="add-cmins" inputmode="decimal" placeholder="30" min="1" /></label>
      </div>
    </div>
    <div style="display:flex;gap:8px;margin-top:14px">
      <button class="btn btn-ghost" style="flex:1" onclick="closeAddForm()">Cancel</button>
      <button class="btn btn-accent" style="flex:2" onclick="submitAdd()">Add to Bench Ôºã</button>
    </div>
  </div>
</div>

<!-- EDIT ITEM (bottom sheet) -->

<div class="edit-overlay" id="edit-overlay" onclick="closeEditSheet()">
  <div class="edit-sheet" onclick="event.stopPropagation()">
    <div class="edit-sheet-title" id="edit-sheet-title">Edit</div>
    <div id="edit-sheet-fields"></div>
    <div style="display:flex;gap:8px;margin-top:14px">
      <button class="btn btn-danger" onclick="deleteEditItem()">Delete</button>
      <button class="btn btn-accent" style="flex:2" onclick="applyEdit()">Save ‚úì</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
// ‚îÄ‚îÄ‚îÄ STORAGE ‚îÄ‚îÄ‚îÄ
const KEY='gymlog_v2', BENCH_KEY='gymlog_bench';
const load=()=>{try{return JSON.parse(localStorage.getItem(KEY))||[];}catch{return[];}};
const save=d=>localStorage.setItem(KEY,JSON.stringify(d));
const loadBench=()=>{try{return JSON.parse(localStorage.getItem(BENCH_KEY))||[];}catch{return[];}};
const saveBench=d=>localStorage.setItem(BENCH_KEY,JSON.stringify(d));
const uid=()=>Date.now().toString(36)+Math.random().toString(36).slice(2,7);
const pad=n=>String(n).padStart(2,'0');
const esc=s=>String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const fmtDate=iso=>new Date(iso).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});
const fmtTime=iso=>new Date(iso).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
const fmtDT=iso=>fmtDate(iso)+' ¬∑ '+fmtTime(iso);
function toLocalDateStr(iso){const d=new Date(iso);return`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;}
function toLocalTimeStr(iso){const d=new Date(iso);return`${pad(d.getHours())}:${pad(d.getMinutes())}`;}

let workouts=load(), currentWorkout=null, viewingId=null, isEditing=false;
let currentExercise=null, currentMetric='weight';
let addType='exercise', editingBenchId=null, editCtx='staging';

// ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ
const TAB_MAP={home:'view-home',progress:'view-progress',settings:'view-settings'};
function showTab(t){document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));document.getElementById(TAB_MAP[t]).classList.add('active');document.getElementById('bottom-nav').style.display='flex';['home','progress','settings'].forEach(x=>document.getElementById('nav-'+x).classList.toggle('active',x===t));if(t==='home')renderHome();if(t==='progress')renderProgress();}
function showView(n){document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));document.getElementById('view-'+n).classList.add('active');document.getElementById('bottom-nav').style.display=['log','detail','graph','staging'].includes(n)?'none':'flex';if(n==='detail')renderDetail();if(n==='graph')renderGraph();}

// ‚îÄ‚îÄ‚îÄ HOME ‚îÄ‚îÄ‚îÄ
function renderHome(){
  workouts=load();checkBackupReminder();
  const el=document.getElementById('home-list'),sub=document.getElementById('home-subtitle');
  sub.textContent=workouts.length?`${workouts.length} session${workouts.length>1?'s':''} logged`:'Your sessions';
  if(!workouts.length){el.innerHTML=`<div class="empty-state"><div class="empty-icon">üèãÔ∏è</div><div class="empty-title">No workouts yet</div><div class="empty-sub">Tap New Workout to plan your first session</div></div>`;return;}
  const sorted=[...workouts].sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
  el.innerHTML=sorted.map(w=>{
    const cc=(w.cardio||[]).map(c=>`<span class="chip accent">üèÉ ${esc(c.type)} ${c.minutes}m</span>`).join('');
    const uniq=[...new Set((w.exercises||[]).map(e=>e.name))];
    const ec=uniq.slice(0,3).map(n=>`<span class="chip">üèãÔ∏è ${esc(n)}</span>`).join('');
    const more=uniq.length>3?`<span class="chip">+${uniq.length-3}</span>`:'';
    return`<div class="workout-card" onclick="openWorkout('${w.id}')"><div class="card-date">${fmtDT(w.timestamp)}</div><div class="card-title">${esc(w.name||'Workout')}</div><div class="card-chips">${cc}${ec}${more}</div></div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STAGING (BENCH / IN)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openStaging(){
  renderStaging();
  showView('staging');
}
function closeStaging(){showTab('home');}

function renderStaging(){
  const bench=loadBench();
  const inItems=bench.filter(x=>x.zone==='in');
  const benchItems=bench.filter(x=>x.zone!=='in');

  document.getElementById('in-count').textContent=inItems.length?`¬∑ ${inItems.length}`:'';
  document.getElementById('bench-count').textContent=benchItems.length?`¬∑ ${benchItems.length}`:'';

  const inEl=document.getElementById('in-list');
  if(!inItems.length){
    inEl.innerHTML='<div class="no-items">Tap bench items to move them in</div>';
  } else {
    inEl.innerHTML=inItems.map(item=>renderStageCard(item,true)).join('');
  }

  const benchEl=document.getElementById('bench-list');
  if(!benchItems.length){
    benchEl.innerHTML='<div class="no-items">Tap Ôºã New to add exercises</div>';
  } else {
    benchEl.innerHTML=benchItems.map(item=>renderStageCard(item,false)).join('');
  }

  // Enable/disable start button
  const btn=document.getElementById('start-workout-btn');
  if(inItems.length){btn.style.opacity='1';btn.style.pointerEvents='auto';}
  else{btn.style.opacity='0.4';btn.style.pointerEvents='none';}
}

function renderStageCard(item,isIn){
  const icon=item.type==='cardio'?'üèÉ':'üèãÔ∏è';
  const iconCls=item.type==='cardio'?'ca':'ex';
  let meta;
  if(item.type==='cardio') meta=`${item.minutes||'?'} min`;
  else{const w=item.weight?item.weight+' lbs ¬∑ ':'';meta=`${w}${item.sets||'?'}√ó${item.reps||'?'}`;}
  const cls=isIn?'stage-card in-zone':'stage-card';
  const action=isIn?'‚úï':'Ôºã';
  return`<div class="${cls}" onclick="editBenchItem('${item.id}')">
    <div class="card-icon ${iconCls}">${icon}</div>
    <div class="card-body">
      <div class="card-name">${esc(item.name)}</div>
      <div class="card-meta">${meta}</div>
    </div>
    <div class="card-action" onclick="event.stopPropagation();toggleZone('${item.id}')" style="font-size:20px;padding:4px 6px">${action}</div>
  </div>`;
}

function toggleZone(id){
  const bench=loadBench();
  const item=bench.find(x=>x.id===id);
  if(!item)return;
  item.zone = item.zone==='in' ? 'bench' : 'in';
  saveBench(bench);
  renderStaging();
}

// ‚îÄ‚îÄ‚îÄ START WORKOUT FROM STAGING ‚îÄ‚îÄ‚îÄ
function startWorkoutFromStaging(){
  const bench=loadBench();
  const inItems=bench.filter(x=>x.zone==='in');
  if(!inItems.length){showToast('Move items In first');return;}

  isEditing=false;
  const cardio=inItems.filter(x=>x.type==='cardio').map(x=>({type:x.name,minutes:x.minutes,done:false}));
  const exercises=inItems.filter(x=>x.type==='exercise').map(x=>({name:x.name,weight:x.weight||null,sets:x.sets,reps:x.reps,done:false}));
  currentWorkout={id:uid(),timestamp:new Date().toISOString(),name:'',cardio,exercises};

  renderLogView();
  showView('log');
}

// ‚îÄ‚îÄ‚îÄ ADD FORM ‚îÄ‚îÄ‚îÄ
function openAddForm(){
  addType='exercise';
  document.getElementById('add-type-ex').classList.add('active');
  document.getElementById('add-type-ca').classList.remove('active');
  document.getElementById('add-fields-ex').style.display='';
  document.getElementById('add-fields-ca').style.display='none';
  document.getElementById('add-name').value='';
  document.getElementById('add-weight').value='';
  document.getElementById('add-sets').value='';
  document.getElementById('add-reps').value='';
  document.getElementById('add-cmins').value='';
  document.getElementById('add-overlay').classList.add('show');
  setTimeout(()=>{if(addType==='exercise')document.getElementById('add-name').focus();},100);
}
function closeAddForm(){document.getElementById('add-overlay').classList.remove('show');}
function setAddType(t){
  addType=t;
  document.getElementById('add-type-ex').classList.toggle('active',t==='exercise');
  document.getElementById('add-type-ca').classList.toggle('active',t==='cardio');
  document.getElementById('add-fields-ex').style.display=t==='exercise'?'':'none';
  document.getElementById('add-fields-ca').style.display=t==='cardio'?'':'none';
}
function submitAdd(){
  const bench=loadBench();
  if(addType==='exercise'){
    const name=document.getElementById('add-name').value.trim();
    const weight=document.getElementById('add-weight').value.trim();
    const sets=parseInt(document.getElementById('add-sets').value,10)||3;
    const reps=parseInt(document.getElementById('add-reps').value,10)||10;
    if(!name){showToast('Enter exercise name');return;}
    bench.push({id:uid(),type:'exercise',name,weight:weight||null,sets,reps,zone:'bench'});
  } else {
    const ctype=document.getElementById('add-ctype').value;
    const mins=parseInt(document.getElementById('add-cmins').value,10);
    if(!mins||mins<1){showToast('Enter duration');return;}
    bench.push({id:uid(),type:'cardio',name:ctype,minutes:mins,zone:'bench'});
  }
  saveBench(bench);
  closeAddForm();
  renderStaging();
  showToast('Added to bench');
}

// ‚îÄ‚îÄ‚îÄ EDIT BENCH ITEM ‚îÄ‚îÄ‚îÄ
function editBenchItem(id){
  editingBenchId=id; editCtx='staging';
  const bench=loadBench();
  const item=bench.find(x=>x.id===id);if(!item)return;
  const isIn=item.zone==='in';
  document.getElementById('edit-sheet-title').textContent='Edit '+item.name;
  let fieldsHtml='';
  if(item.type==='exercise'){
    fieldsHtml=`
      <label class="field" style="margin-bottom:8px">Name<input type="text" id="ed-name" value="${esc(item.name)}" /></label>
      <div class="input-row cols-3">
        <label class="field">Weight (lbs)<input type="number" id="ed-weight" inputmode="decimal" value="${item.weight||''}" min="0" /></label>
        <label class="field">Sets<input type="number" id="ed-sets" inputmode="numeric" value="${item.sets||3}" min="1" /></label>
        <label class="field">Reps<input type="number" id="ed-reps" inputmode="numeric" value="${item.reps||10}" min="1" /></label>
      </div>`;
  } else {
    fieldsHtml=`
      <div class="input-row cols-2">
        <label class="field">Type<select id="ed-ctype">${['Running','Walking','Cycling','Rowing','Elliptical','Stairmaster','Jump Rope','Swimming','HIIT','Other'].map(t=>`<option ${t===item.name?'selected':''}>${t}</option>`).join('')}</select></label>
        <label class="field">Duration (min)<input type="number" id="ed-cmins" inputmode="decimal" value="${item.minutes||30}" min="1" /></label>
      </div>`;
  }
  fieldsHtml+=`<div style="display:flex;gap:8px;margin-top:14px">
    <button class="btn ${isIn?'btn-danger':'btn-ga'}" style="flex:1" onclick="saveAndToggleZone('${item.id}')">${isIn?'‚úï Move to Bench':'Ôºã Move In'}</button>
  </div>`;
  document.getElementById('edit-sheet-fields').innerHTML=fieldsHtml;
  document.getElementById('edit-overlay').classList.add('show');
}

function saveAndToggleZone(id){
  // Save current field values first, then toggle zone
  saveBenchFieldsForId(id);
  const bench=loadBench();
  const item=bench.find(x=>x.id===id);if(!item)return;
  item.zone=item.zone==='in'?'bench':'in';
  saveBench(bench);
  closeEditSheet();renderStaging();
}

function saveBenchFieldsForId(id){
  const bench=loadBench();
  const item=bench.find(x=>x.id===id);if(!item)return;
  if(item.type==='exercise'){
    const nameEl=document.getElementById('ed-name');
    if(nameEl){item.name=nameEl.value.trim()||item.name;item.weight=document.getElementById('ed-weight').value.trim()||null;item.sets=parseInt(document.getElementById('ed-sets').value,10)||3;item.reps=parseInt(document.getElementById('ed-reps').value,10)||10;}
  } else {
    const ctEl=document.getElementById('ed-ctype');
    if(ctEl){item.name=ctEl.value;item.minutes=parseInt(document.getElementById('ed-cmins').value,10)||30;}
  }
  saveBench(bench);
}
function closeEditSheet(){document.getElementById('edit-overlay').classList.remove('show');}
function applyEdit(){
  if(editCtx==='staging'){
    saveBenchFieldsForId(editingBenchId);
    closeEditSheet();renderStaging();
  } else if(editCtx==='checklist'){
    applyChecklistEdit();
  }
}
function deleteEditItem(){
  if(editCtx==='staging'){
    const bench=loadBench().filter(x=>x.id!==editingBenchId);
    saveBench(bench);closeEditSheet();renderStaging();showToast('Removed');
  } else if(editCtx==='checklist'){
    deleteChecklistItem();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOG VIEW (ACTIVE WORKOUT CHECKLIST)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function cancelLog(){if(isEditing)showView('detail');else showTab('home');}

function renderLogView(){
  document.getElementById('log-name').value=currentWorkout.name||'';
  updateDateRowDisplay();
  document.getElementById('date-editor').classList.remove('open');
  renderChecklist();updateProgressBar();
}

function updateDateRowDisplay(){document.getElementById('date-row-display').textContent=fmtDT(currentWorkout.timestamp);}
function toggleDateEditor(){
  const ed=document.getElementById('date-editor'),o=!ed.classList.contains('open');ed.classList.toggle('open');
  if(o){document.getElementById('dp-date').value=toLocalDateStr(currentWorkout.timestamp);document.getElementById('dp-time').value=toLocalTimeStr(currentWorkout.timestamp);}
}
function applyDateEdit(){const d=document.getElementById('dp-date').value,t=document.getElementById('dp-time').value;if(!d||!t)return;currentWorkout.timestamp=new Date(`${d}T${t}:00`).toISOString();updateDateRowDisplay();}

function renderChecklist(){
  const el=document.getElementById('checklist-items');
  const all=[
    ...currentWorkout.cardio.map((c,i)=>({...c,_type:'cardio',_i:i})),
    ...currentWorkout.exercises.map((e,i)=>({...e,_type:'exercise',_i:i}))
  ];
  if(!all.length){el.innerHTML='<div class="no-items">No items</div>';return;}

  el.innerHTML=all.map(item=>{
    const icon=item._type==='cardio'?'üèÉ':'üèãÔ∏è';
    const name=item._type==='cardio'?item.type:item.name;
    let detail;
    if(item._type==='cardio') detail=`${item.minutes} min`;
    else detail=`${item.sets} set${item.sets!=1?'s':''} √ó ${item.reps} reps${item.weight?' @ '+item.weight+' lbs':''}`;
    return`<div class="entry-card ${item.done?'checked':''}">
      <div class="check-circle ${item.done?'done':''}" onclick="toggleDone('${item._type}',${item._i})">‚úì</div>
      <div class="entry-body" onclick="editChecklistItem('${item._type}',${item._i})">
        <div class="entry-name">${esc(name)}</div>
        <div class="entry-detail">${detail}</div>
      </div>
    </div>`;
  }).join('');
}

function toggleDone(type,i){
  if(type==='cardio')currentWorkout.cardio[i].done=!currentWorkout.cardio[i].done;
  else currentWorkout.exercises[i].done=!currentWorkout.exercises[i].done;
  renderChecklist();updateProgressBar();
}

function updateProgressBar(){
  const total=currentWorkout.cardio.length+currentWorkout.exercises.length;
  const done=currentWorkout.cardio.filter(c=>c.done).length+currentWorkout.exercises.filter(e=>e.done).length;
  const wrap=document.getElementById('checklist-progress');
  if(!total){wrap.style.display='none';return;}
  wrap.style.display='';
  const pct=Math.round((done/total)*100);
  document.getElementById('progress-text').textContent=`${done} / ${total} completed`;
  document.getElementById('progress-pct').textContent=pct+'%';
  document.getElementById('progress-fill').style.width=pct+'%';
}

// ‚îÄ‚îÄ‚îÄ EDIT CHECKLIST ITEM ‚îÄ‚îÄ‚îÄ
let editCLType='',editCLIndex=-1;
function editChecklistItem(type,i){
  editCtx='checklist';editCLType=type;editCLIndex=i;
  if(type==='exercise'){
    const e=currentWorkout.exercises[i];
    document.getElementById('edit-sheet-title').textContent='Edit '+e.name;
    document.getElementById('edit-sheet-fields').innerHTML=`
      <label class="field" style="margin-bottom:8px">Name<input type="text" id="ed-name" value="${esc(e.name)}" /></label>
      <div class="input-row cols-3">
        <label class="field">Weight (lbs)<input type="number" id="ed-weight" inputmode="decimal" value="${e.weight||''}" min="0" /></label>
        <label class="field">Sets<input type="number" id="ed-sets" inputmode="numeric" value="${e.sets}" min="1" /></label>
        <label class="field">Reps<input type="number" id="ed-reps" inputmode="numeric" value="${e.reps}" min="1" /></label>
      </div>`;
  } else {
    const c=currentWorkout.cardio[i];
    document.getElementById('edit-sheet-title').textContent='Edit '+c.type;
    document.getElementById('edit-sheet-fields').innerHTML=`
      <div class="input-row cols-2">
        <label class="field">Type<select id="ed-ctype">${['Running','Walking','Cycling','Rowing','Elliptical','Stairmaster','Jump Rope','Swimming','HIIT','Other'].map(t=>`<option ${t===c.type?'selected':''}>${t}</option>`).join('')}</select></label>
        <label class="field">Duration (min)<input type="number" id="ed-cmins" inputmode="decimal" value="${c.minutes}" min="1" /></label>
      </div>`;
  }
  document.getElementById('edit-overlay').classList.add('show');
}
function applyChecklistEdit(){
  if(editCLType==='exercise'){
    const e=currentWorkout.exercises[editCLIndex];
    const name=document.getElementById('ed-name').value.trim();if(!name){showToast('Enter name');return;}
    e.name=name;e.weight=document.getElementById('ed-weight').value.trim()||null;
    e.sets=parseInt(document.getElementById('ed-sets').value,10)||3;
    e.reps=parseInt(document.getElementById('ed-reps').value,10)||10;
  } else {
    const c=currentWorkout.cardio[editCLIndex];
    c.type=document.getElementById('ed-ctype').value;
    c.minutes=parseInt(document.getElementById('ed-cmins').value,10)||30;
  }
  closeEditSheet();renderChecklist();
}
function deleteChecklistItem(){
  if(editCLType==='exercise')currentWorkout.exercises.splice(editCLIndex,1);
  else currentWorkout.cardio.splice(editCLIndex,1);
  closeEditSheet();renderChecklist();updateProgressBar();
}

// ‚îÄ‚îÄ‚îÄ SAVE WORKOUT ‚îÄ‚îÄ‚îÄ
function saveWorkout(){
  const name=document.getElementById('log-name').value.trim();
  currentWorkout.name=name||autoName();
  if(!currentWorkout.cardio.length&&!currentWorkout.exercises.length){showToast('Add at least one item');return;}
  const toSave=JSON.parse(JSON.stringify(currentWorkout));
  toSave.cardio.forEach(c=>delete c.done);toSave.exercises.forEach(e=>delete e.done);

  workouts=load();
  if(isEditing){const idx=workouts.findIndex(w=>w.id===toSave.id);if(idx>=0)workouts[idx]=toSave;else workouts.push(toSave);}
  else workouts.push(toSave);
  save(workouts);

  // Update bench items with latest values from workout
  updateBenchFromWorkout(toSave);

  // Move "in" items back to bench for next time
  const bench=loadBench();
  bench.forEach(item=>{if(item.zone==='in')item.zone='bench';});
  saveBench(bench);

  viewingId=toSave.id;isEditing=false;
  showToast('Workout saved ‚úì');showView('detail');
}

function updateBenchFromWorkout(w){
  const bench=loadBench();
  (w.exercises||[]).forEach(e=>{
    const match=bench.find(b=>b.type==='exercise'&&b.name.toLowerCase()===e.name.toLowerCase());
    if(match){if(e.weight)match.weight=e.weight;match.sets=e.sets;match.reps=e.reps;}
  });
  (w.cardio||[]).forEach(c=>{
    const match=bench.find(b=>b.type==='cardio'&&b.name.toLowerCase()===c.type.toLowerCase());
    if(match)match.minutes=c.minutes;
  });
  saveBench(bench);
}

function autoName(){const h=new Date(currentWorkout.timestamp).getHours();return h<12?'Morning Workout':h<17?'Afternoon Workout':'Evening Workout';}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DETAIL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openWorkout(id){viewingId=id;showView('detail');}
function renderDetail(){
  workouts=load();const w=workouts.find(x=>x.id===viewingId);
  if(!w){showTab('home');return;}
  document.getElementById('detail-date').textContent=fmtDT(w.timestamp);
  document.getElementById('detail-name').textContent=w.name||'Workout';
  const cs=document.getElementById('detail-cardio-section');
  if(w.cardio&&w.cardio.length){cs.style.display='';document.getElementById('detail-cardio-list').innerHTML=w.cardio.map(c=>`<div class="detail-row"><div class="detail-row-icon">üèÉ</div><div class="detail-row-name">${esc(c.type)}</div><div class="detail-row-meta">${c.minutes} min</div></div>`).join('');}else cs.style.display='none';
  const es=document.getElementById('detail-exercise-section');
  if(w.exercises&&w.exercises.length){es.style.display='';document.getElementById('detail-exercise-list').innerHTML=w.exercises.map(e=>`<div class="detail-row"><div class="detail-row-icon">üèãÔ∏è</div><div class="detail-row-name">${esc(e.name)}</div><div class="detail-row-meta">${e.sets}√ó${e.reps}${e.weight?'<br>'+e.weight+' lbs':''}</div></div>`).join('');}else es.style.display='none';
}
function editWorkout(){
  workouts=load();const w=workouts.find(x=>x.id===viewingId);if(!w)return;
  isEditing=true;currentWorkout=JSON.parse(JSON.stringify(w));
  currentWorkout.cardio.forEach(c=>{if(c.done===undefined)c.done=true;});
  currentWorkout.exercises.forEach(e=>{if(e.done===undefined)e.done=true;});
  renderLogView();showView('log');
}

// ‚îÄ‚îÄ‚îÄ REPEAT ‚Üí loads into staging as "in" ‚îÄ‚îÄ‚îÄ
function repeatWorkout(){
  const w=load().find(x=>x.id===viewingId);if(!w)return;
  const bench=loadBench();
  // Move everything to bench first
  bench.forEach(item=>{item.zone='bench';});

  // For each item in the workout, find or create a bench card and set to "in"
  (w.exercises||[]).forEach(e=>{
    let match=bench.find(b=>b.type==='exercise'&&b.name.toLowerCase()===e.name.toLowerCase());
    if(!match){match={id:uid(),type:'exercise',name:e.name,weight:e.weight||null,sets:e.sets,reps:e.reps,zone:'in'};bench.push(match);}
    else{match.zone='in';if(e.weight)match.weight=e.weight;match.sets=e.sets;match.reps=e.reps;}
  });
  (w.cardio||[]).forEach(c=>{
    let match=bench.find(b=>b.type==='cardio'&&b.name.toLowerCase()===c.type.toLowerCase());
    if(!match){match={id:uid(),type:'cardio',name:c.type,minutes:c.minutes,zone:'in'};bench.push(match);}
    else{match.zone='in';match.minutes=c.minutes;}
  });
  saveBench(bench);
  openStaging();
  showToast('Loaded into staging');
}

// ‚îÄ‚îÄ‚îÄ DELETE / COPY ‚îÄ‚îÄ‚îÄ
function confirmDelete(){openModal('Delete workout?',"This can't be undone.",[{label:'Yes, Delete',cls:'btn-danger',fn:'deleteWorkout'},{label:'Cancel',cls:'btn-ghost',fn:'closeModal'}]);}
function deleteWorkout(){workouts=load().filter(w=>w.id!==viewingId);save(workouts);closeModal();showToast('Workout deleted');showTab('home');}
function copyWorkout(){
  workouts=load();const w=workouts.find(x=>x.id===viewingId);if(!w)return;
  let t=`${w.name||'Workout'}\n${fmtDT(w.timestamp)}\n${'‚îÄ'.repeat(28)}\n\n`;
  if(w.cardio&&w.cardio.length){t+='CARDIO\n';w.cardio.forEach(c=>{t+=`  ‚Ä¢ ${c.type} ‚Äî ${c.minutes} min\n`;});t+='\n';}
  if(w.exercises&&w.exercises.length){t+='EXERCISES\n';w.exercises.forEach(e=>{t+=`  ‚Ä¢ ${e.name} ‚Äî ${e.sets} set${e.sets!=1?'s':''}  √ó ${e.reps} reps${e.weight?' @ '+e.weight+' lbs':''}\n`;});}
  t+=`\n${'‚îÄ'.repeat(28)}`;
  if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(t).then(()=>showToast('Copied ‚úì')).catch(()=>fbCopy(t));else fbCopy(t);
}
function fbCopy(text){const ta=document.createElement('textarea');ta.value=text;ta.style.cssText='position:fixed;opacity:0;top:0;left:0;';document.body.appendChild(ta);ta.focus();ta.select();try{document.execCommand('copy');showToast('Copied ‚úì');}catch{showToast('Copy failed');}document.body.removeChild(ta);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROGRESS / GRAPH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderProgress(){
  workouts=load();const el=document.getElementById('progress-list'),map={};
  workouts.forEach(w=>{(w.exercises||[]).forEach(e=>{const key=e.name.toLowerCase();if(!map[key])map[key]={name:e.name,sessions:[],maxWeight:0};const wt=parseFloat(e.weight)||0;map[key].sessions.push({date:w.timestamp,weight:wt,sets:e.sets,reps:e.reps});if(wt>map[key].maxWeight)map[key].maxWeight=wt;});});
  const exercises=Object.values(map).sort((a,b)=>a.name.localeCompare(b.name));
  document.getElementById('progress-sub').textContent=exercises.length?`${exercises.length} exercise${exercises.length>1?'s':''} tracked`:'Tap an exercise to see trends';
  if(!exercises.length){el.innerHTML=`<div class="empty-state"><div class="empty-icon">üìà</div><div class="empty-title">No data yet</div><div class="empty-sub">Log workouts to see your progress here</div></div>`;return;}
  el.innerHTML=exercises.map(ex=>{const meta=ex.maxWeight?`Best: ${ex.maxWeight} lbs ¬∑ ${ex.sessions.length} session${ex.sessions.length>1?'s':''}`:`${ex.sessions.length} session${ex.sessions.length>1?'s':''}`;return`<div class="ex-pick-row" onclick="openGraph('${esc(ex.name)}')"><div><div class="ex-pick-name">${esc(ex.name)}</div><div class="ex-pick-meta">${meta}</div></div><div class="ex-pick-arrow">‚Ä∫</div></div>`;}).join('');
}

function openGraph(name){currentExercise=name;currentMetric='weight';document.querySelectorAll('.metric-btn').forEach(b=>b.classList.remove('active'));document.getElementById('metric-weight').classList.add('active');showView('graph');}
function setMetric(m){currentMetric=m;document.querySelectorAll('.metric-btn').forEach(b=>b.classList.remove('active'));document.getElementById('metric-'+m).classList.add('active');renderGraph();}
function renderGraph(){
  workouts=load();const name=currentExercise;
  document.getElementById('graph-title').textContent=name;
  document.getElementById('graph-sub').textContent={weight:'Max weight per session (lbs)',volume:'Volume = weight √ó sets √ó reps',reps:'Max reps per session'}[currentMetric];
  const pts=[];
  workouts.forEach(w=>{const ms=(w.exercises||[]).filter(e=>e.name.toLowerCase()===name.toLowerCase());if(!ms.length)return;const mW=Math.max(...ms.map(e=>parseFloat(e.weight)||0));const mR=Math.max(...ms.map(e=>e.reps||0));const vol=Math.round(ms.reduce((s,e)=>{const wt=parseFloat(e.weight)||0;return s+(wt>0?wt*e.reps*e.sets:e.reps*e.sets);},0));pts.push({date:w.timestamp,weight:mW,reps:mR,volume:vol,label:fmtDate(w.timestamp)});});
  pts.sort((a,b)=>new Date(a.date)-new Date(b.date));
  const gV=p=>currentMetric==='reps'?p.reps:currentMetric==='volume'?p.volume:p.weight;
  const vals=pts.map(gV).filter(v=>v>0);const unit=currentMetric==='reps'?'reps':'lbs';
  const sE=document.getElementById('graph-stats');
  if(vals.length){const best=Math.max(...vals),lat=vals[vals.length-1],first=vals[0],ch=first>0?Math.round(((lat-first)/first)*100):0;sE.innerHTML=`<div class="stat-card"><div class="stat-val">${best}</div><div class="stat-label">Best (${unit})</div></div><div class="stat-card"><div class="stat-val">${lat}</div><div class="stat-label">Latest</div></div><div class="stat-card"><div class="stat-val" style="color:${ch>=0?'var(--accent)':'var(--red)'}">${ch>=0?'+':''}${ch}%</div><div class="stat-label">Change</div></div>`;}else sE.innerHTML='';
  drawChart(pts);
  const hE=document.getElementById('graph-history');
  if(!pts.length){hE.innerHTML='<div class="no-items">No sessions logged</div>';return;}
  hE.innerHTML=[...pts].reverse().map(p=>{const v=gV(p);return`<div class="history-entry"><div class="history-dot"></div><div class="history-date">${p.label}</div><div class="history-val">${v>0?v+' '+unit:'‚Äî'}</div></div>`;}).join('');
}
function drawChart(pts){
  const canvas=document.getElementById('progress-chart'),wrap=canvas.parentElement,dpr=window.devicePixelRatio||1,W=wrap.clientWidth-32,H=200;
  canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  const gV=p=>currentMetric==='reps'?p.reps:currentMetric==='volume'?p.volume:p.weight;const vals=pts.map(gV);
  ctx.fillStyle='#161618';ctx.fillRect(0,0,W,H);
  if(pts.length<2){ctx.fillStyle='#44444d';ctx.font='13px DM Sans,sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('Log 2+ sessions to see a chart',W/2,H/2);return;}
  const P={top:16,right:14,bottom:30,left:46},cW=W-P.left-P.right,cH=H-P.top-P.bottom;
  const mV=Math.max(...vals.filter(v=>v>0),1),rng=mV||1;
  const xO=i=>P.left+(i/(pts.length-1))*cW,yO=v=>P.top+cH-(v/rng)*cH;
  for(let i=0;i<=4;i++){const y=P.top+(i/4)*cH;ctx.strokeStyle='#2e2e33';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(P.left,y);ctx.lineTo(P.left+cW,y);ctx.stroke();ctx.fillStyle='#7a7a85';ctx.font='11px DM Sans,sans-serif';ctx.textAlign='right';ctx.textBaseline='middle';ctx.fillText(Math.round(mV-(i/4)*rng),P.left-8,y);}
  ctx.fillStyle='#7a7a85';ctx.font='10px DM Sans,sans-serif';ctx.textAlign='center';ctx.textBaseline='top';
  [0,Math.floor((pts.length-1)/2),pts.length-1].forEach(i=>{if(i>=0&&i<pts.length){const d=new Date(pts[i].date);ctx.fillText((d.getMonth()+1)+'/'+(d.getDate()),xO(i),H-18);}});
  const grad=ctx.createLinearGradient(0,P.top,0,P.top+cH);grad.addColorStop(0,'rgba(212,245,60,0.2)');grad.addColorStop(1,'rgba(212,245,60,0)');
  ctx.beginPath();ctx.moveTo(xO(0),yO(vals[0]));vals.forEach((v,i)=>{if(i>0)ctx.lineTo(xO(i),yO(v));});ctx.lineTo(xO(vals.length-1),P.top+cH);ctx.lineTo(xO(0),P.top+cH);ctx.closePath();ctx.fillStyle=grad;ctx.fill();
  ctx.beginPath();ctx.strokeStyle='#d4f53c';ctx.lineWidth=2.5;ctx.lineJoin='round';ctx.lineCap='round';ctx.moveTo(xO(0),yO(vals[0]));vals.forEach((v,i)=>{if(i>0)ctx.lineTo(xO(i),yO(v));});ctx.stroke();
  vals.forEach((v,i)=>{ctx.beginPath();ctx.arc(xO(i),yO(v),4,0,Math.PI*2);ctx.fillStyle='#d4f53c';ctx.fill();ctx.strokeStyle='#0c0c0e';ctx.lineWidth=2;ctx.stroke();});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BACKUP / SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BACKUP_KEY='gymlog_last_backup',DISMISS_KEY='gymlog_banner_dismissed',BACKUP_INTERVAL=7*24*60*60*1000,SNOOZE_DURATION=24*60*60*1000;
function checkBackupReminder(){workouts=load();const b=document.getElementById('backup-banner');if(!workouts.length){b.classList.remove('show');return;}const lb=parseInt(localStorage.getItem(BACKUP_KEY)||'0',10),du=parseInt(localStorage.getItem(DISMISS_KEY)||'0',10),now=Date.now();if(now<du){b.classList.remove('show');return;}if(now-lb>BACKUP_INTERVAL){const d=Math.floor((now-lb)/(24*60*60*1000));document.getElementById('banner-sub').textContent=lb===0?"You've never exported a backup.  Tap to save one.":`Last backup was ${d} day${d!==1?'s':''} ago.`;b.classList.add('show');}else b.classList.remove('show');}
function dismissBanner(){localStorage.setItem(DISMISS_KEY,Date.now()+SNOOZE_DURATION);document.getElementById('backup-banner').classList.remove('show');}
function exportBackupFromBanner(){exportBackup();document.getElementById('backup-banner').classList.remove('show');}

function exportBackup(){workouts=load();const bench=loadBench();if(!workouts.length){showToast('No workouts to export');return;}const json=JSON.stringify({version:3,exported:new Date().toISOString(),workouts,bench},null,2);const blob=new Blob([json],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`gymlog-backup-${new Date().toISOString().slice(0,10)}.json`;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);localStorage.setItem(BACKUP_KEY,Date.now());showToast('Backup exported ‚úì');}
function importBackup(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=e=>{try{const data=JSON.parse(e.target.result);const incoming=data.workouts||data;if(!Array.isArray(incoming))throw new Error();const existing=load();const ids=new Set(existing.map(w=>w.id));const merged=[...existing];let added=0;incoming.forEach(w=>{if(!ids.has(w.id)){merged.push(w);added++;}});save(merged);workouts=merged;if(data.bench&&Array.isArray(data.bench)){const eb=loadBench();const bi=new Set(eb.map(x=>x.id));data.bench.forEach(item=>{if(!bi.has(item.id))eb.push(item);});saveBench(eb);}showToast(`Imported ${added} workout${added!==1?'s':''} ‚úì`);renderHome();}catch{showToast('Import failed ‚Äî invalid file');}};reader.readAsText(file);event.target.value='';}
function confirmClearAll(){openModal('Clear all data?','Permanently deletes all workouts and your bench. Export a backup first.',[{label:'Delete Everything',cls:'btn-danger',fn:'clearAll'},{label:'Cancel',cls:'btn-ghost',fn:'closeModal'}]);}
function clearAll(){localStorage.removeItem(KEY);localStorage.removeItem(BENCH_KEY);workouts=[];closeModal();showToast('All data cleared');renderHome();}

// ‚îÄ‚îÄ‚îÄ MODAL / TOAST / OVERFLOW ‚îÄ‚îÄ‚îÄ
function openModal(title,sub,actions){document.getElementById('modal-title').textContent=title;document.getElementById('modal-sub').textContent=sub;document.getElementById('modal-actions').innerHTML=actions.map(a=>`<button class="btn ${a.cls}" onclick="${a.fn}()">${a.label}</button>`).join('');document.getElementById('modal-overlay').classList.add('show');}
function closeModal(){document.getElementById('modal-overlay').classList.remove('show');}
let toastTimer;function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');clearTimeout(toastTimer);toastTimer=setTimeout(()=>t.classList.remove('show'),2400);}
function toggleOverflow(){document.getElementById('overflow-menu').classList.toggle('open');}
function closeOverflow(){document.getElementById('overflow-menu').classList.remove('open');}
document.addEventListener('click',e=>{if(!e.target.closest('.overflow-wrap'))closeOverflow();});

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ
renderHome();
</script>

</body>
</html>