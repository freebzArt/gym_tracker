<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="GymLog" />
  <title>GymLog</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap');

```
:root {
  --bg: #0c0c0e;
  --surface: #161618;
  --surface2: #1f1f22;
  --border: #2e2e33;
  --accent: #d4f53c;
  --accent-dim: rgba(212,245,60,0.12);
  --text: #f2f2f5;
  --text-muted: #7a7a85;
  --text-faint: #38383f;
  --red: #ff4f4f;
  --red-dim: rgba(255,79,79,0.12);
  --r: 14px;
  --r-sm: 8px;
  --nav-h: 64px;
}

*, *::before, *::after { box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent; }
html { font-size:16px; }
body { background:var(--bg); color:var(--text); font-family:'DM Sans',-apple-system,sans-serif; min-height:100dvh; max-width:430px; margin:0 auto; overflow-x:hidden; }

.view { display:none; flex-direction:column; min-height:100dvh; animation:fadeIn .18s ease; }
.view.active { display:flex; }
@keyframes fadeIn { from{opacity:0;transform:translateY(5px)} to{opacity:1;transform:none} }

.safe-top { height:max(env(safe-area-inset-top),44px); flex-shrink:0; }

/* NAV */
.bottom-nav {
  position:fixed; bottom:0; left:50%; transform:translateX(-50%);
  width:100%; max-width:430px;
  height:calc(var(--nav-h) + env(safe-area-inset-bottom,0px));
  background:rgba(22,22,24,0.96); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px);
  border-top:1px solid var(--border);
  display:flex; align-items:flex-start; padding-top:10px; z-index:50;
}
.nav-btn { flex:1; background:none; border:none; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:4px; padding:0 8px; transition:opacity .12s; }
.nav-btn:active { opacity:.6; }
.nav-icon { font-size:22px; line-height:1; }
.nav-label { font-size:10px; font-weight:600; letter-spacing:.4px; color:var(--text-muted); text-transform:uppercase; }
.nav-btn.active .nav-label { color:var(--accent); }
.nav-btn.active .nav-icon { filter:drop-shadow(0 0 6px var(--accent)); }

.bottom-spacer { height:calc(var(--nav-h) + env(safe-area-inset-bottom,0px) + 16px); flex-shrink:0; }

/* HEADER */
.header { padding:10px 20px 6px; display:flex; align-items:center; justify-content:space-between; flex-shrink:0; }
.logo { font-family:'Bebas Neue',sans-serif; font-size:34px; color:var(--accent); letter-spacing:1px; line-height:1; white-space:nowrap; }
.header-sub { font-size:12px; color:var(--text-muted); margin-top:1px; }

/* BUTTONS */
.btn { border:none; cursor:pointer; font-family:inherit; font-weight:600; transition:opacity .12s,transform .08s; display:flex; align-items:center; justify-content:center; gap:6px; line-height:1; }
.btn:active { opacity:.75; transform:scale(.97); }
.btn-accent  { background:var(--accent); color:#0c0c0e; border-radius:50px; padding:14px 24px; font-size:15px; }
.btn-ghost   { background:var(--surface2); color:var(--text); border-radius:50px; padding:10px 18px; font-size:14px; }
.btn-ga      { background:var(--accent-dim); color:var(--accent); border-radius:50px; padding:10px 18px; font-size:14px; }
.btn-danger  { background:var(--red-dim); color:var(--red); border-radius:50px; padding:10px 18px; font-size:14px; }
.btn-icon    { background:var(--surface2); color:var(--text-muted); border-radius:50px; width:36px; height:36px; font-size:16px; flex-shrink:0; }
.btn-icon.red { background:var(--red-dim); color:var(--red); }

.scroll-body { flex:1; overflow-y:auto; padding:6px 20px; -webkit-overflow-scrolling:touch; }
.section-label { font-size:11px; font-weight:700; letter-spacing:1.2px; text-transform:uppercase; color:var(--text-muted); margin:18px 0 8px; }

/* CARDS */
.workout-card { background:var(--surface); border-radius:var(--r); padding:16px; margin-bottom:10px; cursor:pointer; border:1px solid var(--border); transition:border-color .12s; }
.workout-card:active { border-color:var(--accent); }
.card-date { font-size:12px; font-weight:600; color:var(--text-muted); margin-bottom:4px; }
.card-title { font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:.4px; margin-bottom:6px; }
.card-chips { display:flex; flex-wrap:wrap; gap:5px; }
.chip { background:var(--surface2); border-radius:6px; padding:3px 9px; font-size:12px; font-weight:500; color:var(--text-muted); }
.chip.accent { background:var(--accent-dim); color:var(--accent); }

.empty-state { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; padding:60px 20px; text-align:center; }
.empty-icon { font-size:52px; opacity:.25; }
.empty-title { font-size:18px; font-weight:700; color:var(--text-muted); }
.empty-sub { font-size:13px; color:var(--text-faint); line-height:1.6; }

.fab { position:fixed; bottom:calc(var(--nav-h) + env(safe-area-inset-bottom,0px) + 14px); right:20px; background:var(--accent); color:#0c0c0e; border:none; border-radius:50px; padding:16px 22px; font-family:'DM Sans',sans-serif; font-weight:700; font-size:15px; cursor:pointer; display:flex; align-items:center; gap:7px; box-shadow:0 6px 24px rgba(212,245,60,0.28); transition:opacity .12s,transform .08s; z-index:49; }
.fab:active { opacity:.85; transform:scale(.97); }

/* INPUTS */
.input-row { display:grid; gap:8px; margin-bottom:8px; }
.input-row.cols-2 { grid-template-columns:1fr 1fr; }
.input-row.cols-3 { grid-template-columns:2fr 1fr 1fr; }
label.field { display:flex; flex-direction:column; gap:4px; font-size:12px; font-weight:600; color:var(--text-muted); letter-spacing:.4px; }
input, select { background:var(--surface2); border:1px solid var(--border); border-radius:var(--r-sm); color:var(--text); font-family:inherit; font-size:16px; font-weight:500; padding:11px 13px; width:100%; outline:none; transition:border-color .12s; -webkit-appearance:none; }
input:focus, select:focus { border-color:var(--accent); }
input::placeholder { color:var(--text-faint); }
select option { background:var(--surface2); }

.entry-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--r); padding:13px; margin-bottom:8px; display:flex; align-items:center; gap:11px; }
.entry-body { flex:1; }
.entry-name { font-size:15px; font-weight:600; }
.entry-detail { font-size:13px; color:var(--text-muted); margin-top:2px; }

.add-form { background:var(--surface); border:1px solid var(--border); border-radius:var(--r); padding:15px; margin-bottom:10px; }
.add-form-title { font-size:12px; font-weight:700; color:var(--text-muted); letter-spacing:.6px; text-transform:uppercase; margin-bottom:11px; }
.add-btn-row { display:flex; gap:8px; margin-top:11px; }

.name-input { background:transparent !important; border:none !important; font-family:'Bebas Neue',sans-serif !important; font-size:34px !important; color:var(--text) !important; padding:0 !important; letter-spacing:.5px !important; width:100%; }
.name-input:focus { outline:none; }
.name-input::placeholder { color:var(--text-faint) !important; }

/* DETAIL */
.detail-date { font-size:13px; color:var(--text-muted); font-weight:500; margin-bottom:3px; }
.detail-title { font-family:'Bebas Neue',sans-serif; font-size:38px; letter-spacing:.5px; line-height:1; margin-bottom:18px; }
.detail-row { display:flex; align-items:center; padding:11px 0; border-bottom:1px solid var(--border); gap:12px; }
.detail-row:last-child { border-bottom:none; }
.detail-row-icon { width:32px; height:32px; border-radius:8px; background:var(--surface2); display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; }
.detail-row-name { font-size:15px; font-weight:600; flex:1; }
.detail-row-meta { font-size:13px; color:var(--text-muted); text-align:right; line-height:1.5; }

.action-bar { display:flex; gap:10px; padding:14px 20px; padding-bottom:max(env(safe-area-inset-bottom),16px); flex-shrink:0; border-top:1px solid var(--border); }
.action-bar .btn { flex:1; }
.divider { height:1px; background:var(--border); margin:14px 0; }
.no-items { color:var(--text-faint); font-size:14px; padding:6px 0 2px; font-style:italic; }

/* PROGRESS */
.ex-pick-row { background:var(--surface); border:1px solid var(--border); border-radius:var(--r); padding:14px 16px; display:flex; align-items:center; justify-content:space-between; cursor:pointer; transition:border-color .1s; margin-bottom:8px; }
.ex-pick-row:active { border-color:var(--accent); }
.ex-pick-name { font-size:16px; font-weight:600; }
.ex-pick-meta { font-size:12px; color:var(--text-muted); margin-top:2px; }
.ex-pick-arrow { font-size:20px; color:var(--text-faint); }

/* GRAPH */
.graph-title { font-family:'Bebas Neue',sans-serif; font-size:30px; letter-spacing:.4px; margin-bottom:3px; }
.graph-sub { font-size:13px; color:var(--text-muted); margin-bottom:14px; }
.metric-toggle { display:flex; gap:6px; margin-bottom:14px; }
.metric-btn { flex:1; padding:9px 6px; border-radius:50px; font-family:inherit; font-size:12px; font-weight:600; border:none; cursor:pointer; transition:background .12s,color .12s; background:var(--surface2); color:var(--text-muted); }
.metric-btn.active { background:var(--accent-dim); color:var(--accent); }
.canvas-wrap { background:var(--surface); border:1px solid var(--border); border-radius:var(--r); padding:16px; margin-bottom:14px; overflow:hidden; }
canvas { display:block; width:100%; }
.graph-stats { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:14px; }
.stat-card { background:var(--surface); border:1px solid var(--border); border-radius:var(--r-sm); padding:12px; text-align:center; }
.stat-val { font-family:'Bebas Neue',sans-serif; font-size:26px; color:var(--accent); line-height:1; }
.stat-label { font-size:11px; color:var(--text-muted); margin-top:3px; }
.history-entry { display:flex; align-items:center; padding:11px 0; border-bottom:1px solid var(--border); gap:10px; }
.history-entry:last-child { border-bottom:none; }
.history-dot { width:8px; height:8px; background:var(--accent); border-radius:50%; flex-shrink:0; }
.history-date { font-size:13px; color:var(--text-muted); flex:1; }
.history-val { font-size:15px; font-weight:600; }

/* SETTINGS */
.settings-row { background:var(--surface); border:1px solid var(--border); border-radius:var(--r); padding:16px; display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; cursor:pointer; transition:border-color .1s; }
.settings-row:active { border-color:var(--accent); }
.settings-row-left { display:flex; align-items:center; gap:13px; }
.settings-icon { width:36px; height:36px; border-radius:9px; display:flex; align-items:center; justify-content:center; font-size:18px; flex-shrink:0; }
.si-green { background:rgba(74,222,128,0.12); }
.si-blue  { background:rgba(79,159,255,0.12); }
.si-red   { background:var(--red-dim); }
.settings-row-text .s-title { font-size:15px; font-weight:600; }
.settings-row-text .s-sub { font-size:12px; color:var(--text-muted); margin-top:2px; }
.settings-arrow { font-size:18px; color:var(--text-faint); }
.version-tag { text-align:center; font-size:12px; color:var(--text-faint); padding:20px 0 8px; }

/* TOAST */
#toast { position:fixed; bottom:calc(var(--nav-h) + env(safe-area-inset-bottom,0px) + 16px); left:50%; transform:translateX(-50%) translateY(14px); background:var(--accent); color:#0c0c0e; padding:11px 20px; border-radius:50px; font-size:14px; font-weight:700; pointer-events:none; opacity:0; transition:opacity .2s,transform .2s; white-space:nowrap; z-index:999; }
#toast.show { opacity:1; transform:translateX(-50%) translateY(0); }

/* MODAL */
#modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.72); z-index:100; align-items:flex-end; }
#modal-overlay.show { display:flex; }
.modal-sheet { background:var(--surface); border-radius:20px 20px 0 0; padding:22px 20px; padding-bottom:max(env(safe-area-inset-bottom),24px); width:100%; border-top:1px solid var(--border); }
.modal-title { font-size:18px; font-weight:700; margin-bottom:5px; }
.modal-sub { font-size:14px; color:var(--text-muted); margin-bottom:18px; }
.modal-actions { display:flex; flex-direction:column; gap:10px; }
.modal-actions .btn { padding:16px; border-radius:var(--r); font-size:16px; }

#import-input { display:none; }

/* BACKUP REMINDER BANNER */
#backup-banner {
  display:none;
  margin: 0 20px 10px;
  background: linear-gradient(135deg, rgba(212,245,60,0.14), rgba(212,245,60,0.06));
  border: 1px solid rgba(212,245,60,0.35);
  border-radius: var(--r);
  padding: 14px 16px;
  flex-shrink: 0;
}
#backup-banner.show { display:flex; align-items:center; gap:12px; }
.banner-icon { font-size:26px; flex-shrink:0; }
.banner-body { flex:1; }
.banner-title { font-size:14px; font-weight:700; color:var(--accent); margin-bottom:2px; }
.banner-sub   { font-size:12px; color:var(--text-muted); line-height:1.4; }
.banner-actions { display:flex; flex-direction:column; gap:6px; flex-shrink:0; }
.banner-btn {
  background:var(--accent); color:#0c0c0e;
  border:none; border-radius:50px;
  padding:8px 14px; font-family:inherit;
  font-size:12px; font-weight:700;
  cursor:pointer; white-space:nowrap;
  transition:opacity .12s;
}
.banner-btn:active { opacity:.75; }
.banner-dismiss {
  background:none; border:none;
  font-size:12px; color:var(--text-faint);
  cursor:pointer; font-family:inherit;
  text-align:center; padding:2px;
}
.banner-dismiss:active { opacity:.6; }
```

  </style>
</head>
<body>

<!-- HOME -->

<div class="view active" id="view-home">
  <div class="safe-top"></div>
  <div class="header">
    <div>
      <div class="logo">GymLog</div>
      <div class="header-sub" id="home-subtitle">Your sessions</div>
    </div>
  </div>

  <!-- Weekly backup reminder -->

  <div id="backup-banner">
    <div class="banner-icon">üîî</div>
    <div class="banner-body">
      <div class="banner-title">Weekly backup due</div>
      <div class="banner-sub" id="banner-sub">Save your workouts to a file in case you switch phones or clear Safari.</div>
    </div>
    <div class="banner-actions">
      <button class="banner-btn" onclick="exportBackupFromBanner()">Back up now</button>
      <button class="banner-dismiss" onclick="dismissBanner()">Remind me later</button>
    </div>
  </div>
  <div class="scroll-body" id="home-list"></div>
  <div class="bottom-spacer"></div>
  <button class="fab" onclick="startNewWorkout()"><span style="font-size:18px">Ôºã</span> New Workout</button>
</div>

<!-- LOG -->

<div class="view" id="view-log">
  <div class="safe-top"></div>
  <div class="header">
    <button class="btn btn-ghost" onclick="cancelLog()">‚Üê Back</button>
    <button class="btn btn-ghost" id="log-timestamp" onclick="openDatePicker()"
      style="font-size:12px; color:var(--text-muted); gap:5px;">
      <span id="log-timestamp-text"></span><span style="font-size:10px; opacity:.6;">‚úé</span>
    </button>
  </div>
  <div class="scroll-body">
    <input class="name-input" id="log-name" type="text" placeholder="Workout Name‚Ä¶" maxlength="40" />
    <div class="section-label">Cardio</div>
    <div id="cardio-list"></div>
    <div class="add-form">
      <div class="add-form-title">Add Cardio</div>
      <div class="input-row cols-2">
        <label class="field">Type
          <select id="c-type">
            <option>Running</option><option>Walking</option><option>Cycling</option>
            <option>Rowing</option><option>Elliptical</option><option>Stairmaster</option>
            <option>Jump Rope</option><option>Swimming</option><option>HIIT</option><option>Other</option>
          </select>
        </label>
        <label class="field">Duration (min)<input id="c-duration" type="number" inputmode="decimal" placeholder="30" min="1" /></label>
      </div>
      <div class="add-btn-row"><button class="btn btn-ga" style="flex:1" onclick="addCardio()">Ôºã Add</button></div>
    </div>
    <div class="section-label">Exercises</div>
    <div id="exercise-list"></div>
    <div class="add-form">
      <div class="add-form-title">Add Exercise</div>
      <label class="field" style="margin-bottom:8px">Exercise Name<input id="e-name" type="text" placeholder="e.g. Bicep Curl" autocomplete="off" autocorrect="off" /></label>
      <div class="input-row cols-3">
        <label class="field">Weight (lbs)<input id="e-weight" type="number" inputmode="decimal" placeholder="45" min="0" /></label>
        <label class="field">Sets<input id="e-sets" type="number" inputmode="numeric" placeholder="3" min="1" max="99" /></label>
        <label class="field">Reps<input id="e-reps" type="number" inputmode="numeric" placeholder="10" min="1" max="999" /></label>
      </div>
      <div class="add-btn-row"><button class="btn btn-ga" style="flex:1" onclick="addExercise()">Ôºã Add</button></div>
    </div>
    <div class="bottom-spacer"></div>
  </div>
  <div class="action-bar">
    <button class="btn btn-danger" onclick="cancelLog()">Discard</button>
    <button class="btn btn-accent" style="flex:2" onclick="saveWorkout()">Save Workout ‚úì</button>
  </div>
</div>

<!-- DETAIL -->

<div class="view" id="view-detail">
  <div class="safe-top"></div>
  <div class="header">
    <button class="btn btn-ghost" onclick="showTab('home')">‚Üê Back</button>
  </div>
  <div class="scroll-body">
    <div class="detail-date" id="detail-date"></div>
    <div class="detail-title" id="detail-name"></div>
    <div id="detail-cardio-section" style="display:none">
      <div class="section-label">Cardio</div>
      <div id="detail-cardio-list"></div>
      <div class="divider"></div>
    </div>
    <div id="detail-exercise-section" style="display:none">
      <div class="section-label">Exercises</div>
      <div id="detail-exercise-list"></div>
    </div>
    <div class="bottom-spacer"></div>
  </div>
  <div class="action-bar">
    <button class="btn btn-danger" onclick="confirmDelete()">üóë</button>
    <button class="btn btn-ghost" style="flex:1" onclick="copyWorkout()">üìã Copy</button>
    <button class="btn btn-accent" style="flex:2" onclick="editWorkout()">‚úèÔ∏è Edit</button>
  </div>
</div>

<!-- PROGRESS LIST -->

<div class="view" id="view-progress">
  <div class="safe-top"></div>
  <div class="header">
    <div>
      <div class="logo">Progress</div>
      <div class="header-sub" id="progress-sub">Tap an exercise to see trends</div>
    </div>
  </div>
  <div class="scroll-body" id="progress-list"></div>
  <div class="bottom-spacer"></div>
</div>

<!-- GRAPH -->

<div class="view" id="view-graph">
  <div class="safe-top"></div>
  <div class="header">
    <button class="btn btn-ghost" onclick="showTab('progress')">‚Üê Exercises</button>
  </div>
  <div class="scroll-body">
    <div class="graph-title" id="graph-title"></div>
    <div class="graph-sub" id="graph-sub"></div>
    <div class="metric-toggle">
      <button class="metric-btn active" id="metric-weight" onclick="setMetric('weight')">Max Weight</button>
      <button class="metric-btn" id="metric-volume" onclick="setMetric('volume')">Volume</button>
      <button class="metric-btn" id="metric-reps" onclick="setMetric('reps')">Max Reps</button>
    </div>
    <div class="canvas-wrap"><canvas id="progress-chart" height="200"></canvas></div>
    <div class="graph-stats" id="graph-stats"></div>
    <div class="section-label">Session History</div>
    <div id="graph-history"></div>
    <div class="bottom-spacer"></div>
  </div>
</div>

<!-- SETTINGS -->

<div class="view" id="view-settings">
  <div class="safe-top"></div>
  <div class="header">
    <div>
      <div class="logo">Settings</div>
      <div class="header-sub">Data &amp; backup</div>
    </div>
  </div>
  <div class="scroll-body">
    <div class="section-label">Backup</div>
    <div class="settings-row" onclick="exportBackup()">
      <div class="settings-row-left">
        <div class="settings-icon si-green">‚¨áÔ∏è</div>
        <div class="settings-row-text">
          <div class="s-title">Export Backup</div>
          <div class="s-sub">Save all workouts as a .json file</div>
        </div>
      </div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <div class="settings-row" onclick="document.getElementById('import-input').click()">
      <div class="settings-row-left">
        <div class="settings-icon si-blue">‚¨ÜÔ∏è</div>
        <div class="settings-row-text">
          <div class="s-title">Import Backup</div>
          <div class="s-sub">Restore from a .json backup file</div>
        </div>
      </div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <input type="file" id="import-input" accept=".json" onchange="importBackup(event)" />
    <div class="section-label">Danger Zone</div>
    <div class="settings-row" onclick="confirmClearAll()">
      <div class="settings-row-left">
        <div class="settings-icon si-red">üóëÔ∏è</div>
        <div class="settings-row-text">
          <div class="s-title" style="color:var(--red)">Clear All Data</div>
          <div class="s-sub">Permanently delete all workouts</div>
        </div>
      </div>
      <div class="settings-arrow">‚Ä∫</div>
    </div>
    <div class="divider"></div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:16px;font-size:13px;color:var(--text-muted);line-height:1.7">
      <strong style="color:var(--text)">üí° About your data</strong><br><br>
      All workouts are stored locally inside Safari on this device. To protect against phone wipes or upgrades, <strong style="color:var(--accent)">export a backup regularly</strong> and save it to iCloud Drive or email it to yourself. You can import it back here on any device.
    </div>
    <div class="version-tag">GymLog v2 ¬∑ Made for iPhone</div>
    <div class="bottom-spacer"></div>
  </div>
</div>

<!-- BOTTOM NAV -->

<nav class="bottom-nav" id="bottom-nav">
  <button class="nav-btn active" id="nav-home" onclick="showTab('home')">
    <span class="nav-icon">üè†</span><span class="nav-label">Log</span>
  </button>
  <button class="nav-btn" id="nav-progress" onclick="showTab('progress')">
    <span class="nav-icon">üìà</span><span class="nav-label">Progress</span>
  </button>
  <button class="nav-btn" id="nav-settings" onclick="showTab('settings')">
    <span class="nav-icon">‚öôÔ∏è</span><span class="nav-label">Settings</span>
  </button>
</nav>

<!-- DATE PICKER MODAL -->

<div id="datepicker-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.72);z-index:200;align-items:flex-end;" onclick="closeDatePicker()">
  <div style="background:var(--surface);border-radius:20px 20px 0 0;padding:22px 20px;padding-bottom:max(env(safe-area-inset-bottom),28px);width:100%;border-top:1px solid var(--border);" onclick="event.stopPropagation()">
    <div style="font-size:18px;font-weight:700;margin-bottom:4px;">Edit Date &amp; Time</div>
    <div style="font-size:13px;color:var(--text-muted);margin-bottom:18px;">Log this workout for a different day</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:18px;">
      <label class="field">Date
        <input type="date" id="dp-date" />
      </label>
      <label class="field">Time
        <input type="time" id="dp-time" />
      </label>
    </div>
    <div style="display:flex;gap:10px;">
      <button class="btn btn-ghost" style="flex:1" onclick="closeDatePicker()">Cancel</button>
      <button class="btn btn-accent" style="flex:2" onclick="applyDatePicker()">Apply</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<div id="modal-overlay" onclick="closeModal()">
  <div class="modal-sheet" onclick="event.stopPropagation()">
    <div class="modal-title" id="modal-title"></div>
    <div class="modal-sub" id="modal-sub"></div>
    <div class="modal-actions" id="modal-actions"></div>
  </div>
</div>

<script>
const KEY = 'gymlog_v2';
const load = () => { try { return JSON.parse(localStorage.getItem(KEY))||[]; } catch{return[];} };
const save = d => localStorage.setItem(KEY, JSON.stringify(d));
const uid  = () => Date.now().toString(36) + Math.random().toString(36).slice(2,7);
const esc  = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const fmtDate = iso => new Date(iso).toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});
const fmtTime = iso => new Date(iso).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
const fmtDT   = iso => fmtDate(iso)+' ¬∑ '+fmtTime(iso);

let workouts = load();
let currentWorkout = null;
let viewingId = null;
let isEditing = false;
let currentExercise = null;
let currentMetric = 'weight';

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const TAB_MAP = {home:'view-home', progress:'view-progress', settings:'view-settings'};

function showTab(tab) {
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById(TAB_MAP[tab]).classList.add('active');
  document.getElementById('bottom-nav').style.display='flex';
  ['home','progress','settings'].forEach(t=>document.getElementById('nav-'+t).classList.toggle('active',t===tab));
  if(tab==='home')     renderHome();
  if(tab==='progress') renderProgress();
}

function showView(name) {
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById('view-'+name).classList.add('active');
  document.getElementById('bottom-nav').style.display=['log','detail','graph'].includes(name)?'none':'flex';
  if(name==='detail') renderDetail();
  if(name==='graph')  renderGraph();
}

// ‚îÄ‚îÄ HOME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function renderHome() {
  workouts = load();
  checkBackupReminder();
  const el=document.getElementById('home-list');
  document.getElementById('home-subtitle').textContent=workouts.length?`${workouts.length} session${workouts.length>1?'s':''} logged`:'Your sessions';
  if(!workouts.length){
    el.innerHTML=`<div class="empty-state"><div class="empty-icon">üèãÔ∏è</div><div class="empty-title">No workouts yet</div><div class="empty-sub">Tap New Workout to log your first session</div></div>`;
    return;
  }
  const sorted=[...workouts].sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
  el.innerHTML=sorted.map(w=>{
    const cc=(w.cardio||[]).map(c=>`<span class="chip accent">üèÉ ${c.type} ${c.minutes}m</span>`).join('');
    const uniq=[...new Set((w.exercises||[]).map(e=>e.name))];
    const ec=uniq.slice(0,3).map(n=>`<span class="chip">üèãÔ∏è ${esc(n)}</span>`).join('');
    const more=uniq.length>3?`<span class="chip">+${uniq.length-3}</span>`:'';
    return `<div class="workout-card" onclick="openWorkout('${w.id}')"><div class="card-date">${fmtDT(w.timestamp)}</div><div class="card-title">${esc(w.name||'Workout')}</div><div class="card-chips">${cc}${ec}${more}</div></div>`;
  }).join('');
}

// ‚îÄ‚îÄ LOG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function startNewWorkout() {
  isEditing=false;
  currentWorkout={id:uid(),timestamp:new Date().toISOString(),name:'',cardio:[],exercises:[]};
  renderLogView(); showView('log');
}

function cancelLog() { if(isEditing){showView('detail');}else{showTab('home');} }

function renderLogView() {
  document.getElementById('log-name').value=currentWorkout.name||'';
  document.getElementById('log-timestamp-text').textContent=fmtDT(currentWorkout.timestamp);
  renderCardioList(); renderExerciseList();
}

function renderCardioList() {
  const el=document.getElementById('cardio-list');
  if(!currentWorkout.cardio.length){el.innerHTML='<div class="no-items">No cardio yet</div>';return;}
  el.innerHTML=currentWorkout.cardio.map((c,i)=>`<div class="entry-card"><div class="detail-row-icon">üèÉ</div><div class="entry-body"><div class="entry-name">${esc(c.type)}</div><div class="entry-detail">${c.minutes} minutes</div></div><button class="btn btn-icon red" onclick="removeCardio(${i})">‚úï</button></div>`).join('');
}

function renderExerciseList() {
  const el=document.getElementById('exercise-list');
  if(!currentWorkout.exercises.length){el.innerHTML='<div class="no-items">No exercises yet</div>';return;}
  el.innerHTML=currentWorkout.exercises.map((e,i)=>`<div class="entry-card"><div class="detail-row-icon">üèãÔ∏è</div><div class="entry-body"><div class="entry-name">${esc(e.name)}</div><div class="entry-detail">${e.sets} set${e.sets!=1?'s':''} √ó ${e.reps} reps${e.weight?' @ '+e.weight+' lbs':''}</div></div><button class="btn btn-icon red" onclick="removeExercise(${i})">‚úï</button></div>`).join('');
}

function addCardio() {
  const type=document.getElementById('c-type').value;
  const mins=parseInt(document.getElementById('c-duration').value,10);
  if(!mins||mins<1){showToast('Enter a duration');return;}
  currentWorkout.cardio.push({type,minutes:mins});
  document.getElementById('c-duration').value='';
  renderCardioList();
}

function addExercise() {
  const name=document.getElementById('e-name').value.trim();
  const weight=document.getElementById('e-weight').value.trim();
  const sets=parseInt(document.getElementById('e-sets').value,10);
  const reps=parseInt(document.getElementById('e-reps').value,10);
  if(!name){showToast('Enter exercise name');return;}
  if(!sets||sets<1){showToast('Enter sets');return;}
  if(!reps||reps<1){showToast('Enter reps');return;}
  currentWorkout.exercises.push({name,weight:weight||null,sets,reps});
  document.getElementById('e-weight').value='';
  document.getElementById('e-sets').value='';
  document.getElementById('e-reps').value='';
  renderExerciseList();
}

function removeCardio(i)   {currentWorkout.cardio.splice(i,1);renderCardioList();}
function removeExercise(i) {currentWorkout.exercises.splice(i,1);renderExerciseList();}

function saveWorkout() {
  const name=document.getElementById('log-name').value.trim();
  currentWorkout.name=name||autoName();
  if(!currentWorkout.cardio.length&&!currentWorkout.exercises.length){showToast('Add at least one item');return;}
  workouts=load();
  if(isEditing){const idx=workouts.findIndex(w=>w.id===currentWorkout.id);if(idx>=0)workouts[idx]=currentWorkout;else workouts.push(currentWorkout);}
  else workouts.push(currentWorkout);
  save(workouts); viewingId=currentWorkout.id; isEditing=false;
  showToast('Workout saved ‚úì'); showView('detail');
}

function autoName() {
  const h=new Date(currentWorkout.timestamp).getHours();
  return h<12?'Morning Workout':h<17?'Afternoon Workout':'Evening Workout';
}

// ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function openWorkout(id) {viewingId=id; showView('detail');}

function renderDetail() {
  workouts=load();
  const w=workouts.find(x=>x.id===viewingId);
  if(!w){showTab('home');return;}
  document.getElementById('detail-date').textContent=fmtDT(w.timestamp);
  document.getElementById('detail-name').textContent=w.name||'Workout';
  const cs=document.getElementById('detail-cardio-section');
  if(w.cardio&&w.cardio.length){
    cs.style.display='';
    document.getElementById('detail-cardio-list').innerHTML=w.cardio.map(c=>`<div class="detail-row"><div class="detail-row-icon">üèÉ</div><div class="detail-row-name">${esc(c.type)}</div><div class="detail-row-meta">${c.minutes} min</div></div>`).join('');
  } else cs.style.display='none';
  const es=document.getElementById('detail-exercise-section');
  if(w.exercises&&w.exercises.length){
    es.style.display='';
    document.getElementById('detail-exercise-list').innerHTML=w.exercises.map(e=>`<div class="detail-row"><div class="detail-row-icon">üèãÔ∏è</div><div class="detail-row-name">${esc(e.name)}</div><div class="detail-row-meta">${e.sets}√ó${e.reps}${e.weight?'<br>'+e.weight+' lbs':''}</div></div>`).join('');
  } else es.style.display='none';
}

function editWorkout() {
  workouts=load(); const w=workouts.find(x=>x.id===viewingId); if(!w) return;
  isEditing=true; currentWorkout=JSON.parse(JSON.stringify(w));
  renderLogView(); showView('log');
}

// ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function confirmDelete() {
  openModal('Delete workout?',"This can't be undone.",[
    {label:'Yes, Delete',cls:'btn-danger',fn:'deleteWorkout'},
    {label:'Cancel',cls:'btn-ghost',fn:'closeModal'}
  ]);
}

function deleteWorkout() {
  workouts=load().filter(w=>w.id!==viewingId); save(workouts);
  closeModal(); showToast('Workout deleted'); showTab('home');
}

// ‚îÄ‚îÄ COPY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function copyWorkout() {
  workouts=load(); const w=workouts.find(x=>x.id===viewingId); if(!w) return;
  let t=`${w.name||'Workout'}\n${fmtDT(w.timestamp)}\n${'‚îÄ'.repeat(28)}\n\n`;
  if(w.cardio&&w.cardio.length){t+=`CARDIO\n`;w.cardio.forEach(c=>{t+=`  ‚Ä¢ ${c.type} ‚Äî ${c.minutes} min\n`;});t+='\n';}
  if(w.exercises&&w.exercises.length){t+=`EXERCISES\n`;w.exercises.forEach(e=>{t+=`  ‚Ä¢ ${e.name} ‚Äî ${e.sets} set${e.sets!=1?'s':''}  √ó ${e.reps} reps${e.weight?' @ '+e.weight+' lbs':''}\n`;});}
  t+=`\n${'‚îÄ'.repeat(28)}`;
  if(navigator.clipboard?.writeText) navigator.clipboard.writeText(t).then(()=>showToast('Copied ‚úì')).catch(()=>fbCopy(t));
  else fbCopy(t);
}

function fbCopy(text) {
  const ta=document.createElement('textarea');ta.value=text;ta.style.cssText='position:fixed;opacity:0;';
  document.body.appendChild(ta);ta.focus();ta.select();
  try{document.execCommand('copy');showToast('Copied ‚úì');}catch{showToast('Copy failed');}
  document.body.removeChild(ta);
}

// ‚îÄ‚îÄ PROGRESS LIST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function renderProgress() {
  workouts=load();
  const el=document.getElementById('progress-list');
  const map={};
  workouts.forEach(w=>{
    (w.exercises||[]).forEach(e=>{
      const key=e.name.toLowerCase();
      if(!map[key]) map[key]={name:e.name,sessions:[],maxWeight:0};
      const wt=parseFloat(e.weight)||0;
      map[key].sessions.push({date:w.timestamp,weight:wt,sets:e.sets,reps:e.reps});
      if(wt>map[key].maxWeight) map[key].maxWeight=wt;
    });
  });
  const exercises=Object.values(map).sort((a,b)=>a.name.localeCompare(b.name));
  document.getElementById('progress-sub').textContent=exercises.length?`${exercises.length} exercise${exercises.length>1?'s':''} tracked`:'Tap an exercise to see trends';
  if(!exercises.length){
    el.innerHTML=`<div class="empty-state"><div class="empty-icon">üìà</div><div class="empty-title">No data yet</div><div class="empty-sub">Log workouts to see your progress here</div></div>`;
    return;
  }
  el.innerHTML=exercises.map(ex=>{
    const meta=ex.maxWeight?`Best: ${ex.maxWeight} lbs ¬∑ ${ex.sessions.length} session${ex.sessions.length>1?'s':''}`:`${ex.sessions.length} session${ex.sessions.length>1?'s':''}`;
    return `<div class="ex-pick-row" onclick="openGraph('${esc(ex.name)}')"><div><div class="ex-pick-name">${esc(ex.name)}</div><div class="ex-pick-meta">${meta}</div></div><div class="ex-pick-arrow">‚Ä∫</div></div>`;
  }).join('');
}

// ‚îÄ‚îÄ GRAPH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function openGraph(name) {
  currentExercise=name; currentMetric='weight';
  document.querySelectorAll('.metric-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('metric-weight').classList.add('active');
  showView('graph');
}

function setMetric(m) {
  currentMetric=m;
  document.querySelectorAll('.metric-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('metric-'+m).classList.add('active');
  renderGraph();
}

function renderGraph() {
  workouts=load();
  const name=currentExercise;
  document.getElementById('graph-title').textContent=name;
  const metricLabel={weight:'Max weight per session (lbs)',volume:'Volume = weight √ó sets √ó reps (lbs)',reps:'Max reps per session'};
  document.getElementById('graph-sub').textContent=metricLabel[currentMetric];

  const pts=[];
  workouts.forEach(w=>{
    const matches=(w.exercises||[]).filter(e=>e.name.toLowerCase()===name.toLowerCase());
    if(!matches.length) return;
    const maxWt=Math.max(...matches.map(e=>parseFloat(e.weight)||0));
    const maxRep=Math.max(...matches.map(e=>e.reps||0));
    const vol=matches.reduce((s,e)=>{const wt=parseFloat(e.weight)||0;return s+(wt>0?wt*e.reps*e.sets:e.reps*e.sets);},0);
    pts.push({date:w.timestamp,weight:maxWt,reps:maxRep,volume:Math.round(vol),label:fmtDate(w.timestamp)});
  });
  pts.sort((a,b)=>new Date(a.date)-new Date(b.date));

  const getVal=p=>currentMetric==='reps'?p.reps:currentMetric==='volume'?p.volume:p.weight;
  const vals=pts.map(getVal).filter(v=>v>0);

  // Stats
  const statsEl=document.getElementById('graph-stats');
  if(vals.length){
    const best=Math.max(...vals);
    const latest=vals[vals.length-1];
    const first=vals[0];
    const change=first>0?Math.round(((latest-first)/first)*100):0;
    const unit=currentMetric==='reps'?'reps':'lbs';
    statsEl.innerHTML=`
      <div class="stat-card"><div class="stat-val">${best}</div><div class="stat-label">Best (${unit})</div></div>
      <div class="stat-card"><div class="stat-val">${latest}</div><div class="stat-label">Latest</div></div>
      <div class="stat-card"><div class="stat-val" style="color:${change>=0?'var(--accent)':'var(--red)'}">${change>=0?'+':''}${change}%</div><div class="stat-label">Change</div></div>`;
  } else statsEl.innerHTML='';

  drawChart(pts);

  // History
  const histEl=document.getElementById('graph-history');
  if(!pts.length){histEl.innerHTML='<div class="no-items">No sessions logged</div>';return;}
  const unit=currentMetric==='reps'?'reps':'lbs';
  histEl.innerHTML=[...pts].reverse().map(p=>{
    const v=getVal(p);
    return `<div class="history-entry"><div class="history-dot"></div><div class="history-date">${p.label}</div><div class="history-val">${v>0?v+' '+unit:'‚Äî'}</div></div>`;
  }).join('');
}

function drawChart(pts) {
  const canvas=document.getElementById('progress-chart');
  const wrap=canvas.parentElement;
  const dpr=window.devicePixelRatio||1;
  const W=wrap.clientWidth-32;
  const H=200;
  canvas.width=W*dpr; canvas.height=H*dpr;
  canvas.style.width=W+'px'; canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');
  ctx.scale(dpr,dpr);

  const getVal=p=>currentMetric==='reps'?p.reps:currentMetric==='volume'?p.volume:p.weight;
  const vals=pts.map(getVal);

  ctx.fillStyle='#161618'; ctx.fillRect(0,0,W,H);

  if(pts.length<2){
    ctx.fillStyle='#44444d'; ctx.font='13px DM Sans,sans-serif';
    ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText('Log 2+ sessions to see a chart',W/2,H/2);
    return;
  }

  const PAD={top:16,right:14,bottom:30,left:46};
  const cW=W-PAD.left-PAD.right;
  const cH=H-PAD.top-PAD.bottom;
  const validVals=vals.filter(v=>v>0);
  const maxV=Math.max(...validVals,1);
  const minV=0;
  const range=maxV-minV||1;
  const xOf=i=>PAD.left+(i/(pts.length-1))*cW;
  const yOf=v=>PAD.top+cH-((v-minV)/range)*cH;

  // Grid
  for(let i=0;i<=4;i++){
    const y=PAD.top+(i/4)*cH;
    ctx.strokeStyle='#2e2e33'; ctx.lineWidth=1;
    ctx.beginPath(); ctx.moveTo(PAD.left,y); ctx.lineTo(PAD.left+cW,y); ctx.stroke();
    ctx.fillStyle='#7a7a85'; ctx.font='11px DM Sans,sans-serif';
    ctx.textAlign='right'; ctx.textBaseline='middle';
    ctx.fillText(Math.round(maxV-(i/4)*range), PAD.left-8, y);
  }

  // X labels
  ctx.fillStyle='#7a7a85'; ctx.font='10px DM Sans,sans-serif'; ctx.textAlign='center'; ctx.textBaseline='top';
  [0,Math.floor((pts.length-1)/2),pts.length-1].forEach(i=>{
    if(i>=0&&i<pts.length){
      const d=new Date(pts[i].date);
      ctx.fillText((d.getMonth()+1)+'/'+(d.getDate()), xOf(i), H-18);
    }
  });

  // Gradient fill
  const grad=ctx.createLinearGradient(0,PAD.top,0,PAD.top+cH);
  grad.addColorStop(0,'rgba(212,245,60,0.2)'); grad.addColorStop(1,'rgba(212,245,60,0)');
  ctx.beginPath();
  ctx.moveTo(xOf(0),yOf(vals[0]));
  vals.forEach((v,i)=>{if(i>0)ctx.lineTo(xOf(i),yOf(v));});
  ctx.lineTo(xOf(vals.length-1),PAD.top+cH); ctx.lineTo(xOf(0),PAD.top+cH);
  ctx.closePath(); ctx.fillStyle=grad; ctx.fill();

  // Line
  ctx.beginPath(); ctx.strokeStyle='#d4f53c'; ctx.lineWidth=2.5; ctx.lineJoin='round'; ctx.lineCap='round';
  ctx.moveTo(xOf(0),yOf(vals[0]));
  vals.forEach((v,i)=>{if(i>0)ctx.lineTo(xOf(i),yOf(v));});
  ctx.stroke();

  // Dots
  vals.forEach((v,i)=>{
    ctx.beginPath(); ctx.arc(xOf(i),yOf(v),4,0,Math.PI*2);
    ctx.fillStyle='#d4f53c'; ctx.fill();
    ctx.strokeStyle='#0c0c0e'; ctx.lineWidth=2; ctx.stroke();
  });
}

// ‚îÄ‚îÄ DATE PICKER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function openDatePicker() {
  const d   = new Date(currentWorkout.timestamp);
  const pad = n => String(n).padStart(2,'0');
  document.getElementById('dp-date').value = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  document.getElementById('dp-time').value = `${pad(d.getHours())}:${pad(d.getMinutes())}`;
  const ov = document.getElementById('datepicker-overlay');
  ov.style.display='flex';
}

function closeDatePicker() {
  document.getElementById('datepicker-overlay').style.display='none';
}

function applyDatePicker() {
  const date = document.getElementById('dp-date').value;
  const time = document.getElementById('dp-time').value;
  if (!date || !time) { showToast('Pick a date and time'); return; }
  currentWorkout.timestamp = new Date(`${date}T${time}`).toISOString();
  document.getElementById('log-timestamp-text').textContent = fmtDT(currentWorkout.timestamp);
  closeDatePicker();
}



const BACKUP_KEY      = 'gymlog_last_backup';
const DISMISS_KEY     = 'gymlog_banner_dismissed';
const BACKUP_INTERVAL = 7 * 24 * 60 * 60 * 1000; // 7 days in ms
const SNOOZE_DURATION =     24 * 60 * 60 * 1000; // snooze 24h on dismiss

function checkBackupReminder() {
  workouts = load();
  if (!workouts.length) return; // nothing to back up

  const lastBackup   = parseInt(localStorage.getItem(BACKUP_KEY)  || '0', 10);
  const dismissedUntil = parseInt(localStorage.getItem(DISMISS_KEY) || '0', 10);
  const now          = Date.now();

  // Don't show if snoozed
  if (now < dismissedUntil) return;

  const daysSince = Math.floor((now - lastBackup) / (24*60*60*1000));

  if (now - lastBackup > BACKUP_INTERVAL) {
    const sub = lastBackup === 0
      ? 'You\'ve never exported a backup. Save one in case you switch phones or clear Safari.'
      : `Last backup was ${daysSince} day${daysSince!==1?'s':''} ago. Tap to save a fresh copy.`;
    document.getElementById('banner-sub').textContent = sub;
    document.getElementById('backup-banner').classList.add('show');
  } else {
    document.getElementById('backup-banner').classList.remove('show');
  }
}

function dismissBanner() {
  // Snooze for 24 hours
  localStorage.setItem(DISMISS_KEY, Date.now() + SNOOZE_DURATION);
  document.getElementById('backup-banner').classList.remove('show');
}

function exportBackupFromBanner() {
  exportBackup();
  document.getElementById('backup-banner').classList.remove('show');
}



function exportBackup() {
  workouts=load();
  if(!workouts.length){showToast('No workouts to export');return;}
  const json=JSON.stringify({version:2,exported:new Date().toISOString(),workouts},null,2);
  const blob=new Blob([json],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url; a.download=`gymlog-backup-${new Date().toISOString().slice(0,10)}.json`;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
  URL.revokeObjectURL(url);
  localStorage.setItem(BACKUP_KEY, Date.now()); // record backup time
  showToast('Backup exported ‚úì');
}

function importBackup(event) {
  const file=event.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const data=JSON.parse(e.target.result);
      const incoming=data.workouts||data;
      if(!Array.isArray(incoming)) throw new Error();
      const existing=load(); const ids=new Set(existing.map(w=>w.id));
      const merged=[...existing]; let added=0;
      incoming.forEach(w=>{if(!ids.has(w.id)){merged.push(w);added++;}});
      save(merged); workouts=merged;
      showToast(`Imported ${added} workout${added!==1?'s':''} ‚úì`);
      renderHome();
    } catch{showToast('Import failed ‚Äî invalid file');}
  };
  reader.readAsText(file); event.target.value='';
}

function confirmClearAll() {
  openModal('Clear all data?','This permanently deletes all workouts. Export a backup first.',[
    {label:'Delete Everything',cls:'btn-danger',fn:'clearAll'},
    {label:'Cancel',cls:'btn-ghost',fn:'closeModal'}
  ]);
}

function clearAll() {
  localStorage.removeItem(KEY); workouts=[];
  closeModal(); showToast('All data cleared'); renderHome();
}

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function openModal(title,sub,actions) {
  document.getElementById('modal-title').textContent=title;
  document.getElementById('modal-sub').textContent=sub;
  document.getElementById('modal-actions').innerHTML=actions.map(a=>`<button class="btn ${a.cls}" onclick="${a.fn}()">${a.label}</button>`).join('');
  document.getElementById('modal-overlay').classList.add('show');
}
function closeModal() {document.getElementById('modal-overlay').classList.remove('show');}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

let toastTimer;
function showToast(msg) {
  const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show');
  clearTimeout(toastTimer); toastTimer=setTimeout(()=>t.classList.remove('show'),2400);
}

// ‚îÄ‚îÄ PREVENT DOUBLE-TAP ZOOM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let lastTap=0;
document.addEventListener('touchend',e=>{const n=Date.now();if(n-lastTap<300)e.preventDefault();lastTap=n;},{passive:false});

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
renderHome();
</script>

</body>
</html>